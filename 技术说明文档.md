# Relationship Management Backend - æŠ€æœ¯è¯´æ˜æ–‡æ¡£

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
3. [æ ¸å¿ƒåŠŸèƒ½æ¨¡å—](#æ ¸å¿ƒåŠŸèƒ½æ¨¡å—)
4. [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
5. [å®‰å…¨æœºåˆ¶](#å®‰å…¨æœºåˆ¶)
6. [AIé›†æˆ](#aié›†æˆ)
7. [APIæ¥å£](#apiæ¥å£)
8. [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
9. [éƒ¨ç½²æŒ‡å—](#éƒ¨ç½²æŒ‡å—)
10. [å¼€å‘è§„èŒƒ](#å¼€å‘è§„èŒƒ)

---

## é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®ä¿¡æ¯
- **é¡¹ç›®åç§°**: Relationship Management Backend (å…³ç³»ç®¡ç†åç«¯ç³»ç»Ÿ)
- **ç‰ˆæœ¬**: 0.0.1-SNAPSHOT
- **æè¿°**: ä¸€ä¸ªåŸºäºAIé©±åŠ¨çš„å…³ç³»ç®¡ç†ç³»ç»Ÿï¼Œå¸®åŠ©ç”¨æˆ·æ›´å¥½åœ°ç»´æŠ¤å’Œæ”¹å–„äººé™…å…³ç³»
- **ä¸»è¦è¯­è¨€**: Java 17
- **æ„å»ºå·¥å…·**: Maven

### æ ¸å¿ƒä»·å€¼
æœ¬ç³»ç»Ÿé€šè¿‡AIæŠ€æœ¯è¾…åŠ©ç”¨æˆ·ï¼š
- ç³»ç»ŸåŒ–ç®¡ç†ä¸ªäººè”ç³»äººä¿¡æ¯
- é€šè¿‡å¯¹è¯å¼äº¤äº’æ·±åº¦äº†è§£è”ç³»äºº
- æ™ºèƒ½ç”Ÿæˆå…³ç³»æ”¹å–„ç­–ç•¥å’Œè¡ŒåŠ¨è®¡åˆ’
- æä¾›æ™ºèƒ½æé†’å’Œå…³ç³»æ´å¯Ÿ
- æ”¯æŒçŸ¥è¯†æ”¶è—å’Œå›é¡¾

---

## æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆ

#### åç«¯æ¡†æ¶
- **Spring Boot 3.5.6**: ä¸»åº”ç”¨æ¡†æ¶
- **Spring Security**: å®‰å…¨è®¤è¯å’Œæˆæƒ
- **Spring Data JPA**: æ•°æ®æŒä¹…åŒ–å±‚
- **Spring WebFlux**: å“åº”å¼HTTPå®¢æˆ·ç«¯ï¼ˆç”¨äºAIè°ƒç”¨ï¼‰

#### æ•°æ®åº“
- **MySQL**: ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“
- **H2**: å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒå†…å­˜æ•°æ®åº“
- **Flyway**: æ•°æ®åº“ç‰ˆæœ¬ç®¡ç†å’Œè¿ç§»

#### å®‰å…¨ä¸è®¤è¯
- **JWT (JJWT 0.11.5)**: Tokenè®¤è¯
- **BCrypt**: å¯†ç åŠ å¯†
- **Firebase Admin SDK 9.2.0**: æ¨é€é€šçŸ¥æœåŠ¡

#### APIæ–‡æ¡£
- **SpringDoc OpenAPI 2.6.0**: APIæ–‡æ¡£ç”Ÿæˆï¼ˆSwagger UIï¼‰

#### å·¥å…·åº“
- **Lombok**: ç®€åŒ–Javaä»£ç 
- **Jakarta Validation**: è¯·æ±‚å‚æ•°æ ¡éªŒ

#### æµ‹è¯•æ¡†æ¶
- **JUnit 5**: å•å…ƒæµ‹è¯•
- **Testcontainers**: é›†æˆæµ‹è¯•ï¼ˆMySQLå®¹å™¨ï¼‰
- **Spring Security Test**: å®‰å…¨æµ‹è¯•

### é¡¹ç›®ç»“æ„

```
com.ulog.backend
â”œâ”€â”€ ai/                          # AIæœåŠ¡æ¨¡å—
â”‚   â”œâ”€â”€ AiSummaryService         # AIæ‘˜è¦æœåŠ¡æ¥å£
â”‚   â”œâ”€â”€ AiSummaryServiceImpl     # AIæ‘˜è¦æœåŠ¡å®ç°
â”‚   â”œâ”€â”€ DeepseekClient           # Deepseek APIå®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ DeepseekController       # Deepseekæ§åˆ¶å™¨
â”‚   â”œâ”€â”€ DeepseekService          # DeepseekæœåŠ¡
â”‚   â”œâ”€â”€ GoalAiService            # ç›®æ ‡AIæœåŠ¡
â”‚   â””â”€â”€ dto/                     # AIç›¸å…³DTO
â”‚
â”œâ”€â”€ auth/                        # è®¤è¯æ¨¡å—
â”‚   â”œâ”€â”€ controller/              # è®¤è¯æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ dto/                     # è®¤è¯DTO
â”‚   â””â”€â”€ service/                 # è®¤è¯æœåŠ¡
â”‚
â”œâ”€â”€ common/                      # é€šç”¨æ¨¡å—
â”‚   â”œâ”€â”€ api/                     # ç»Ÿä¸€APIå“åº”
â”‚   â”‚   â”œâ”€â”€ ApiResponse          # ç»Ÿä¸€å“åº”åŒ…è£…
â”‚   â”‚   â””â”€â”€ ErrorCode            # é”™è¯¯ç å®šä¹‰
â”‚   â””â”€â”€ exception/               # å¼‚å¸¸å¤„ç†
â”‚       â”œâ”€â”€ GlobalExceptionHandler
â”‚       â””â”€â”€ å„ç±»è‡ªå®šä¹‰å¼‚å¸¸
â”‚
â”œâ”€â”€ config/                      # é…ç½®æ¨¡å—
â”‚   â”œâ”€â”€ SecurityConfig           # å®‰å…¨é…ç½®
â”‚   â”œâ”€â”€ CorsConfig              # CORSé…ç½®
â”‚   â”œâ”€â”€ JwtProperties           # JWTå±æ€§
â”‚   â”œâ”€â”€ DeepseekClientConfig    # Deepseekå®¢æˆ·ç«¯é…ç½®
â”‚   â”œâ”€â”€ FirebaseConfig          # Firebaseé…ç½®
â”‚   â”œâ”€â”€ OpenApiConfig           # APIæ–‡æ¡£é…ç½®
â”‚   â””â”€â”€ TraceIdFilter           # è¯·æ±‚è¿½è¸ªè¿‡æ»¤å™¨
â”‚
â”œâ”€â”€ contact/                     # è”ç³»äººæ¨¡å—
â”‚   â”œâ”€â”€ controller/              # è”ç³»äººæ§åˆ¶å™¨
â”‚   â”œâ”€â”€ dto/                     # è”ç³»äººDTO
â”‚   â””â”€â”€ service/                 # è”ç³»äººæœåŠ¡
â”‚       â”œâ”€â”€ ContactService       # è”ç³»äººCRUD
â”‚       â””â”€â”€ AibookService        # AIæ´å¯ŸæœåŠ¡
â”‚
â”œâ”€â”€ conversation/                # å¯¹è¯æ¨¡å—
â”‚   â”œâ”€â”€ controller/              # å¯¹è¯æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ dto/                     # å¯¹è¯DTO
â”‚   â”œâ”€â”€ enums/                   # æšä¸¾ç±»
â”‚   â”œâ”€â”€ service/                 # å¯¹è¯æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ InfoCollectionService     # è”ç³»äººä¿¡æ¯æ”¶é›†
â”‚   â”‚   â”œâ”€â”€ UserInfoCollectionService # ç”¨æˆ·ä¿¡æ¯æ”¶é›†
â”‚   â”‚   â”œâ”€â”€ InfoSupplementService     # ä¿¡æ¯è¡¥å……
â”‚   â”‚   â”œâ”€â”€ QaService                 # è”ç³»äººé—®ç­”
â”‚   â”‚   â”œâ”€â”€ UserQaService             # ç”¨æˆ·é—®ç­”
â”‚   â”‚   â””â”€â”€ QaHistoryService          # é—®ç­”å†å²
â”‚   â””â”€â”€ util/
â”‚       â””â”€â”€ PromptTemplates      # AIæç¤ºè¯æ¨¡æ¿
â”‚
â”œâ”€â”€ domain/                      # é¢†åŸŸæ¨¡å‹
â”‚   â”œâ”€â”€ contact/                 # è”ç³»äººå®ä½“
â”‚   â”œâ”€â”€ conversation/            # å¯¹è¯ä¼šè¯å®ä½“
â”‚   â”œâ”€â”€ goal/                    # ç›®æ ‡ç›¸å…³å®ä½“
â”‚   â”œâ”€â”€ pin/                     # Pinæ”¶è—å®ä½“
â”‚   â”œâ”€â”€ token/                   # Tokenå®ä½“
â”‚   â””â”€â”€ user/                    # ç”¨æˆ·å®ä½“
â”‚
â”œâ”€â”€ goal/                        # ç›®æ ‡ç®¡ç†æ¨¡å—
â”‚   â”œâ”€â”€ controller/              # ç›®æ ‡æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ dto/                     # ç›®æ ‡DTO
â”‚   â””â”€â”€ service/                 # ç›®æ ‡æœåŠ¡
â”‚       â”œâ”€â”€ GoalService          # ç›®æ ‡ç®¡ç†
â”‚       â”œâ”€â”€ ActionPlanService    # è¡ŒåŠ¨è®¡åˆ’
â”‚       â””â”€â”€ ReminderService      # æé†’æœåŠ¡
â”‚
â”œâ”€â”€ pin/                         # Pinæ”¶è—æ¨¡å—
â”‚   â”œâ”€â”€ controller/              # Pinæ§åˆ¶å™¨
â”‚   â”œâ”€â”€ dto/                     # Pin DTO
â”‚   â””â”€â”€ service/                 # PinæœåŠ¡
â”‚
â”œâ”€â”€ push/                        # æ¨é€é€šçŸ¥æ¨¡å—
â”‚   â”œâ”€â”€ controller/              # æ¨é€æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ PushNotificationService  # æ¨é€æœåŠ¡
â”‚   â””â”€â”€ PushTokenService         # Tokenç®¡ç†
â”‚
â”œâ”€â”€ repository/                  # æ•°æ®è®¿é—®å±‚
â”‚   â”œâ”€â”€ UserRepository
â”‚   â”œâ”€â”€ ContactRepository
â”‚   â”œâ”€â”€ ConversationSessionRepository
â”‚   â”œâ”€â”€ UserConversationSessionRepository
â”‚   â”œâ”€â”€ RelationshipGoalRepository
â”‚   â”œâ”€â”€ ActionPlanRepository
â”‚   â”œâ”€â”€ ReminderRepository
â”‚   â”œâ”€â”€ PinRepository
â”‚   â”œâ”€â”€ RefreshTokenRepository
â”‚   â””â”€â”€ UserPushTokenRepository
â”‚
â”œâ”€â”€ security/                    # å®‰å…¨æ¨¡å—
â”‚   â”œâ”€â”€ JwtTokenProvider         # JWTç”Ÿæˆå’ŒéªŒè¯
â”‚   â”œâ”€â”€ JwtAuthenticationFilter  # JWTè®¤è¯è¿‡æ»¤å™¨
â”‚   â”œâ”€â”€ CustomUserDetailsService # ç”¨æˆ·è¯¦æƒ…æœåŠ¡
â”‚   â””â”€â”€ UserPrincipal           # ç”¨æˆ·ä¸»ä½“
â”‚
â”œâ”€â”€ user/                        # ç”¨æˆ·æ¨¡å—
â”‚   â”œâ”€â”€ controller/              # ç”¨æˆ·æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ dto/                     # ç”¨æˆ·DTO
â”‚   â””â”€â”€ service/                 # ç”¨æˆ·æœåŠ¡
â”‚
â”œâ”€â”€ util/                        # å·¥å…·ç±»
â”‚   â”œâ”€â”€ E164Phone               # å›½é™…ç”µè¯å·ç éªŒè¯
â”‚   â”œâ”€â”€ E164PhoneValidator      # ç”µè¯å·ç éªŒè¯å™¨
â”‚   â””â”€â”€ RateLimiterService      # é™æµæœåŠ¡
â”‚
â””â”€â”€ BackendApplication.java      # ä¸»åº”ç”¨å…¥å£
```

---

## æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. ç”¨æˆ·è®¤è¯ä¸æˆæƒæ¨¡å— (auth)

#### åŠŸèƒ½ç‰¹æ€§
- âœ… åŸºäºæ‰‹æœºå·çš„ç”¨æˆ·æ³¨å†Œ
- âœ… å¯†ç ç™»å½•ï¼ˆBCryptåŠ å¯†ï¼‰
- âœ… JWTåŒTokenæœºåˆ¶ï¼ˆAccess Token + Refresh Tokenï¼‰
- âœ… Tokenåˆ·æ–°å’Œç™»å‡º
- âœ… è´¦æˆ·é”å®šæœºåˆ¶ï¼ˆé˜²æš´åŠ›ç ´è§£ï¼‰

#### æŠ€æœ¯å®ç°
```java
// JWTé…ç½®
- Access Tokenæœ‰æ•ˆæœŸ: 15åˆ†é’Ÿ
- Refresh Tokenæœ‰æ•ˆæœŸ: 14å¤©
- ä½¿ç”¨RS256ç®—æ³•ç­¾å
- å¯†ç å¼ºåº¦: BCrypt 12è½®åŠ å¯†
```

#### å®‰å…¨ç‰¹æ€§
- å¯†ç é”™è¯¯ç´¯è®¡é”å®šï¼ˆ5æ¬¡å¤±è´¥é”å®š30åˆ†é’Ÿï¼‰
- è‡ªåŠ¨Tokenè¿‡æœŸç®¡ç†
- è·¨åŸŸè¯·æ±‚ä¿æŠ¤
- æ— çŠ¶æ€ä¼šè¯ç®¡ç†

### 2. è”ç³»äººç®¡ç†æ¨¡å— (contact)

#### åŠŸèƒ½ç‰¹æ€§
- âœ… è”ç³»äººCRUDæ“ä½œ
- âœ… è”ç³»äººä¿¡æ¯AIæ‘˜è¦ç”Ÿæˆ
- âœ… å…³ç³»æ´å¯Ÿï¼ˆAibookï¼‰ç”Ÿæˆ
- âœ… è”ç³»äººæœç´¢å’Œåˆ†é¡µ

#### AIåŠŸèƒ½
- **AI Summary**: åŸºäºå¯¹è¯å†å²è‡ªåŠ¨ç”Ÿæˆè”ç³»äººç‰¹å¾æ‘˜è¦
- **Aibook**: æ·±åº¦åˆ†æè”ç³»äººå…³ç³»ï¼Œç”Ÿæˆå…³ç³»æ´å¯ŸæŠ¥å‘Š

### 3. å¯¹è¯ç®¡ç†æ¨¡å— (conversation)

è¿™æ˜¯ç³»ç»Ÿçš„æ ¸å¿ƒæ¨¡å—ï¼Œé€šè¿‡å¯¹è¯å¼äº¤äº’æ”¶é›†å’Œç®¡ç†ä¿¡æ¯ã€‚

#### 3.1 è”ç³»äººä¿¡æ¯æ”¶é›† (InfoCollectionService)

**åŠŸèƒ½**: é€šè¿‡å¤šè½®å¯¹è¯æ”¶é›†è”ç³»äººçš„è¯¦ç»†ä¿¡æ¯

**æµç¨‹**:
```
1. å¼€å§‹æ”¶é›† â†’ åˆ›å»ºä¼šè¯
2. AIæé—® â†’ ç”¨æˆ·å›ç­”
3. ä¿¡æ¯æå– â†’ ç»“æ„åŒ–å­˜å‚¨
4. åˆ¤æ–­å®Œæ•´æ€§ â†’ ç»§ç»­æˆ–ç»“æŸ
5. ç”Ÿæˆæ‘˜è¦ â†’ æ›´æ–°è”ç³»äºº
```

**AIèƒ½åŠ›**:
- è‡ªç„¶å¯¹è¯å¼•å¯¼
- è‡ªåŠ¨ä¿¡æ¯æå–
- æ”¶é›†å®Œæ•´æ€§åˆ¤æ–­
- æ™ºèƒ½æ‘˜è¦ç”Ÿæˆ

#### 3.2 ç”¨æˆ·ä¿¡æ¯æ”¶é›† (UserInfoCollectionService)

**åŠŸèƒ½**: æ”¶é›†ç”¨æˆ·è‡ªèº«çš„ä»·å€¼è§‚ã€æ€§æ ¼ç‰¹å¾ç­‰ä¿¡æ¯

**æ”¶é›†ç»´åº¦**:
- åŸºæœ¬ä¿¡æ¯ï¼ˆå¹´é¾„ã€èŒä¸šã€å…´è¶£ï¼‰
- ä»·å€¼è§‚ï¼ˆé‡è¦çš„ä»·å€¼è§‚å¿µï¼‰
- æ€§æ ¼ç‰¹å¾ï¼ˆMBTIã€äº”å¤§äººæ ¼ç­‰ï¼‰
- ç”Ÿæ´»æ–¹å¼åå¥½

#### 3.3 è”ç³»äººé—®ç­”ç³»ç»Ÿ (QaService)

**åŠŸèƒ½**: åŸºäºè”ç³»äººä¿¡æ¯çš„æ™ºèƒ½é—®ç­”

**ç‰¹æ€§**:
- ä¸Šä¸‹æ–‡æ„ŸçŸ¥å¯¹è¯
- ä¿¡æ¯è¡¥å……æœºåˆ¶
- é—®ç­”å†å²è®°å½•
- æ”¯æŒPinæ”¶è—

**è¡¥å……ä¿¡æ¯æµç¨‹**:
```
ç”¨æˆ·æé—® â†’ AIåˆ¤æ–­ä¿¡æ¯æ˜¯å¦è¶³å¤Ÿ
    â”œâ”€ è¶³å¤Ÿ: ç›´æ¥å›ç­”
    â””â”€ ä¸è¶³: åé—®ç”¨æˆ·è¡¥å…… â†’ ç”¨æˆ·å›ç­” â†’ ç”Ÿæˆå®Œæ•´ç­”æ¡ˆ
```

#### 3.4 ç”¨æˆ·è‡ªæˆ‘é—®ç­” (UserQaService)

**åŠŸèƒ½**: å¸®åŠ©ç”¨æˆ·è‡ªæˆ‘è®¤çŸ¥å’Œæˆé•¿

**åº”ç”¨åœºæ™¯**:
- è‡ªæˆ‘åæ€
- ä»·å€¼è§‚æ¾„æ¸…
- å†³ç­–è¾…åŠ©
- ä¸ªäººæˆé•¿å»ºè®®

### 4. å…³ç³»ç›®æ ‡ç®¡ç†æ¨¡å— (goal)

#### åŠŸèƒ½æ¶æ„

```
å…³ç³»ç›®æ ‡
  â”œâ”€ AIç­–ç•¥ç”Ÿæˆ
  â”œâ”€ è¡ŒåŠ¨è®¡åˆ’åˆ—è¡¨
  â”‚   â”œâ”€ è®¡åˆ’1 (å·²é‡‡çº³)
  â”‚   â”œâ”€ è®¡åˆ’2 (æœªé‡‡çº³)
  â”‚   â””â”€ è®¡åˆ’3 (å·²å®Œæˆ)
  â””â”€ æé†’ç³»ç»Ÿ
      â”œâ”€ è‡ªåŠ¨åˆ›å»ºæé†’
      â”œâ”€ å®šæ—¶å‘é€æ¨é€
      â””â”€ æé†’çŠ¶æ€è·Ÿè¸ª
```

#### æ ¸å¿ƒæµç¨‹

**1. åˆ›å»ºç›®æ ‡**
```http
POST /api/goals
{
  "contactId": 1,
  "goalDescription": "å¸Œæœ›èƒ½å¤Ÿå’Œè¿™ä¸ªè”ç³»äººå»ºç«‹æ›´æ·±åšçš„å‹è°Š"
}
```

**è¿”å›**:
- AIç”Ÿæˆçš„ç­–ç•¥å»ºè®®
- 3-5ä¸ªå…·ä½“è¡ŒåŠ¨è®¡åˆ’
- æ¯ä¸ªè®¡åˆ’åŒ…å«æ ‡é¢˜ã€æè¿°ã€å»ºè®®æ—¶é—´

**2. é‡‡çº³ç®¡ç†**
```http
PUT /api/goals/{goalId}/plans/{planId}/adopt
```
- ç”¨æˆ·å¯é€‰æ‹©æ€§é‡‡çº³AIå»ºè®®
- åªæœ‰å·²é‡‡çº³çš„è®¡åˆ’æ‰ä¼šåˆ›å»ºæé†’

**3. çŠ¶æ€è·Ÿè¸ª**
- PENDING: å¾…æ‰§è¡Œ
- IN_PROGRESS: æ‰§è¡Œä¸­
- COMPLETED: å·²å®Œæˆ
- SKIPPED: å·²è·³è¿‡

**4. æ¨é€æé†’**
- è‡ªåŠ¨åœ¨è®¡åˆ’æ—¶é—´å‰15åˆ†é’Ÿæé†’
- é€šè¿‡FCMæ¨é€åˆ°ç”¨æˆ·è®¾å¤‡
- æ”¯æŒiOSå’ŒAndroid

### 5. Pinæ”¶è—æ¨¡å— (pin)

#### åŠŸèƒ½æ¦‚è¿°
å°†å¯¹è¯ä¸­çš„é‡è¦QAæ”¶è—èµ·æ¥ï¼Œæ–¹ä¾¿æ—¥åæŸ¥çœ‹å’Œå›é¡¾ã€‚

#### æ•°æ®ç»“æ„
```java
Pin {
  - sourceType: CONTACT_QA / USER_QA
  - sessionId: æ¥æºä¼šè¯ID
  - qaIndex: QAåœ¨å†å²ä¸­çš„ç´¢å¼•
  - contactId: å…³è”è”ç³»äººï¼ˆå¯é€‰ï¼‰
  - question: ç”¨æˆ·é—®é¢˜
  - answer: AIå›ç­”
  - supplementQuestion: è¡¥å……é—®é¢˜ï¼ˆå¯é€‰ï¼‰
  - supplementAnswer: è¡¥å……å›ç­”ï¼ˆå¯é€‰ï¼‰
  - contextInfo: ä¸Šä¸‹æ–‡å…ƒæ•°æ®ï¼ˆJSONï¼‰
  - note: ç”¨æˆ·å¤‡æ³¨
  - tags: æ ‡ç­¾
}
```

#### ä¸»è¦åŠŸèƒ½
- âœ… æ”¶è—QAå¯¹è¯
- âœ… æ·»åŠ å¤‡æ³¨å’Œæ ‡ç­¾
- âœ… æŒ‰è”ç³»äººç­›é€‰
- âœ… æŒ‰æ¥æºç±»å‹ç­›é€‰
- âœ… é˜²é‡å¤æ”¶è—

### 6. æ¨é€é€šçŸ¥æ¨¡å— (push)

#### æŠ€æœ¯å®ç°
- **æœåŠ¡**: Firebase Cloud Messaging (FCM)
- **æ”¯æŒå¹³å°**: iOSã€Android
- **æ¨é€ç±»å‹**: è¡ŒåŠ¨è®¡åˆ’æé†’

#### æ ¸å¿ƒåŠŸèƒ½
```java
// æ³¨å†Œè®¾å¤‡Token
POST /api/push/register
{
  "deviceToken": "fcm-token",
  "deviceType": "iOS"
}

// å‘é€æ¨é€
pushNotificationService.sendReminder(userId, title, body, data)
```

#### å®šæ—¶ä»»åŠ¡
```java
@Scheduled(cron = "0 * * * * *")  // æ¯åˆ†é’Ÿæ‰§è¡Œ
public void checkAndSendReminders() {
  // æŸ¥è¯¢éœ€è¦å‘é€çš„æé†’
  // å‘é€æ¨é€é€šçŸ¥
  // æ›´æ–°æé†’çŠ¶æ€
}
```

---

## æ•°æ®åº“è®¾è®¡

### æ•°æ®åº“ç‰ˆæœ¬å†å²

ç³»ç»Ÿä½¿ç”¨Flywayè¿›è¡Œæ•°æ®åº“ç‰ˆæœ¬ç®¡ç†ï¼Œå½“å‰å…±6ä¸ªç‰ˆæœ¬ï¼š

| ç‰ˆæœ¬ | æ–‡ä»¶å | è¯´æ˜ |
|------|--------|------|
| V1 | V1__init.sql | åˆå§‹åŒ–ï¼ˆç”¨æˆ·ã€è”ç³»äººã€Tokenï¼‰ |
| V2 | V2__create_conversation_sessions.sql | è”ç³»äººå¯¹è¯ä¼šè¯ |
| V3 | V3__create_user_conversation_sessions.sql | ç”¨æˆ·è‡ªæˆ‘å¯¹è¯ä¼šè¯ |
| V4 | V4__add_qa_history_and_self_value.sql | QAå†å²å’Œç”¨æˆ·ä»·å€¼è§‚ |
| V5 | V5__create_relationship_goals.sql | å…³ç³»ç›®æ ‡å’Œè¡ŒåŠ¨è®¡åˆ’ |
| V6 | V6__create_pins.sql | Pinæ”¶è—åŠŸèƒ½ |

### æ ¸å¿ƒæ•°æ®è¡¨

#### 1. users (ç”¨æˆ·è¡¨)
```sql
CREATE TABLE users (
    uid BIGINT AUTO_INCREMENT PRIMARY KEY,
    phone VARCHAR(32) NOT NULL UNIQUE,         -- æ‰‹æœºå·ï¼ˆå”¯ä¸€ï¼‰
    password_hash VARCHAR(255) NOT NULL,       -- å¯†ç å“ˆå¸Œ
    name VARCHAR(64) NOT NULL,                 -- ç”¨æˆ·å
    description VARCHAR(512),                  -- è‡ªæˆ‘æè¿°
    ai_summary VARCHAR(1024),                  -- AIç”Ÿæˆçš„ç”¨æˆ·æ‘˜è¦
    status TINYINT NOT NULL DEFAULT 1,         -- çŠ¶æ€
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted TINYINT DEFAULT 0,
    failed_attempts INT NOT NULL DEFAULT 0,    -- ç™»å½•å¤±è´¥æ¬¡æ•°
    last_failed_at DATETIME,                   -- æœ€åå¤±è´¥æ—¶é—´
    locked_until DATETIME                      -- é”å®šåˆ°æœŸæ—¶é—´
) ENGINE = InnoDB;
```

#### 2. contacts (è”ç³»äººè¡¨)
```sql
CREATE TABLE contacts (
    cid BIGINT AUTO_INCREMENT PRIMARY KEY,
    owner_uid BIGINT NOT NULL,                 -- æ‰€æœ‰è€…ç”¨æˆ·ID
    name VARCHAR(128) NOT NULL,                -- è”ç³»äººåç§°
    description VARCHAR(1024),                 -- æè¿°
    ai_summary VARCHAR(2048),                  -- AIç”Ÿæˆçš„æ‘˜è¦
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted TINYINT DEFAULT 0,
    FOREIGN KEY (owner_uid) REFERENCES users(uid)
) ENGINE = InnoDB;
```

#### 3. conversation_sessions (è”ç³»äººå¯¹è¯ä¼šè¯)
```sql
CREATE TABLE conversation_sessions (
    session_id VARCHAR(100) PRIMARY KEY,
    user_id BIGINT NOT NULL,
    contact_id BIGINT NOT NULL,
    status VARCHAR(20) NOT NULL,               -- ACTIVE/COMPLETED
    qa_history TEXT,                           -- QAå†å²ï¼ˆJSONï¼‰
    extraction_result TEXT,                    -- æå–çš„ä¿¡æ¯ï¼ˆJSONï¼‰
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(uid),
    FOREIGN KEY (contact_id) REFERENCES contacts(cid)
) ENGINE = InnoDB;
```

#### 4. user_conversation_sessions (ç”¨æˆ·è‡ªæˆ‘å¯¹è¯ä¼šè¯)
```sql
CREATE TABLE user_conversation_sessions (
    session_id VARCHAR(100) PRIMARY KEY,
    user_id BIGINT NOT NULL,
    status VARCHAR(20) NOT NULL,
    qa_history TEXT,
    self_value TEXT,                           -- ç”¨æˆ·ä»·å€¼è§‚ï¼ˆJSONï¼‰
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(uid)
) ENGINE = InnoDB;
```

#### 5. relationship_goals (å…³ç³»ç›®æ ‡è¡¨)
```sql
CREATE TABLE relationship_goals (
    goal_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    contact_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    goal_description TEXT NOT NULL,            -- ç›®æ ‡æè¿°
    ai_strategy TEXT,                          -- AIç”Ÿæˆçš„ç­–ç•¥
    status VARCHAR(20) NOT NULL DEFAULT 'ACTIVE',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted TINYINT DEFAULT 0,
    FOREIGN KEY (contact_id) REFERENCES contacts(cid),
    FOREIGN KEY (user_id) REFERENCES users(uid)
) ENGINE = InnoDB;
```

#### 6. action_plans (è¡ŒåŠ¨è®¡åˆ’è¡¨)
```sql
CREATE TABLE action_plans (
    plan_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    goal_id BIGINT NOT NULL,
    title VARCHAR(255) NOT NULL,               -- è®¡åˆ’æ ‡é¢˜
    description TEXT,                          -- è®¡åˆ’æè¿°
    scheduled_time DATETIME NOT NULL,          -- è®¡åˆ’æ‰§è¡Œæ—¶é—´
    is_adopted TINYINT NOT NULL DEFAULT 1,     -- æ˜¯å¦é‡‡çº³
    status VARCHAR(20) NOT NULL DEFAULT 'PENDING',
    completed_at DATETIME,
    order_index INT NOT NULL DEFAULT 0,        -- æ’åºç´¢å¼•
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted TINYINT DEFAULT 0,
    FOREIGN KEY (goal_id) REFERENCES relationship_goals(goal_id) ON DELETE CASCADE
) ENGINE = InnoDB;
```

#### 7. reminders (æé†’è¡¨)
```sql
CREATE TABLE reminders (
    reminder_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    plan_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    remind_time DATETIME NOT NULL,             -- æé†’æ—¶é—´
    status VARCHAR(20) NOT NULL DEFAULT 'PENDING',
    sent_at DATETIME,                          -- å‘é€æ—¶é—´
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (plan_id) REFERENCES action_plans(plan_id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(uid)
) ENGINE = InnoDB;
```

#### 8. pins (Pinæ”¶è—è¡¨)
```sql
CREATE TABLE pins (
    pin_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    source_type VARCHAR(20) NOT NULL,          -- CONTACT_QA/USER_QA
    session_id VARCHAR(100) NOT NULL,
    qa_index INT NOT NULL,                     -- QAç´¢å¼•
    contact_id BIGINT NULL,
    question TEXT NOT NULL,
    answer TEXT NOT NULL,
    supplement_question TEXT,
    supplement_answer TEXT,
    needs_more_info TINYINT DEFAULT 0,
    context_info TEXT,                         -- ä¸Šä¸‹æ–‡ï¼ˆJSONï¼‰
    note VARCHAR(500),                         -- ç”¨æˆ·å¤‡æ³¨
    tags VARCHAR(255),                         -- æ ‡ç­¾
    qa_timestamp VARCHAR(50),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(uid) ON DELETE CASCADE,
    FOREIGN KEY (contact_id) REFERENCES contacts(cid) ON DELETE SET NULL,
    UNIQUE KEY uk_user_session_qa (user_id, session_id, qa_index)
) ENGINE = InnoDB;
```

#### 9. user_push_tokens (æ¨é€Tokenè¡¨)
```sql
CREATE TABLE user_push_tokens (
    token_id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    device_token VARCHAR(512) NOT NULL,        -- FCMè®¾å¤‡Token
    device_type VARCHAR(20) NOT NULL,          -- iOS/Android
    is_active TINYINT NOT NULL DEFAULT 1,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(uid),
    UNIQUE KEY uk_device_token (device_token)
) ENGINE = InnoDB;
```

#### 10. refresh_tokens (åˆ·æ–°Tokenè¡¨)
```sql
CREATE TABLE refresh_tokens (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    token VARCHAR(512) NOT NULL UNIQUE,
    expires_at DATETIME NOT NULL,
    revoked TINYINT NOT NULL DEFAULT 0,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(uid)
) ENGINE = InnoDB;
```

### æ•°æ®åº“ç´¢å¼•ç­–ç•¥

```sql
-- è”ç³»äºº
CREATE INDEX idx_contacts_owner ON contacts(owner_uid);

-- ç›®æ ‡
CREATE INDEX idx_goals_user ON relationship_goals(user_id);
CREATE INDEX idx_goals_contact ON relationship_goals(contact_id);
CREATE INDEX idx_goals_status ON relationship_goals(status);

-- è¡ŒåŠ¨è®¡åˆ’
CREATE INDEX idx_action_plans_goal ON action_plans(goal_id);
CREATE INDEX idx_action_plans_status ON action_plans(status);
CREATE INDEX idx_action_plans_scheduled ON action_plans(scheduled_time);

-- æé†’
CREATE INDEX idx_reminders_plan ON reminders(plan_id);
CREATE INDEX idx_reminders_user ON reminders(user_id);
CREATE INDEX idx_reminders_time_status ON reminders(remind_time, status);

-- Pin
CREATE INDEX idx_pins_user ON pins(user_id);
CREATE INDEX idx_pins_source_type ON pins(source_type);
CREATE INDEX idx_pins_contact ON pins(contact_id);
CREATE INDEX idx_pins_created ON pins(created_at);
CREATE INDEX idx_pins_user_contact ON pins(user_id, contact_id);

-- æ¨é€Token
CREATE INDEX idx_push_tokens_user ON user_push_tokens(user_id);
CREATE INDEX idx_push_tokens_active ON user_push_tokens(is_active);
```

---

## å®‰å…¨æœºåˆ¶

### 1. è®¤è¯æµç¨‹

```
ç”¨æˆ·ç™»å½•è¯·æ±‚
    â†“
éªŒè¯æ‰‹æœºå·å’Œå¯†ç 
    â†“
æ£€æŸ¥è´¦æˆ·é”å®šçŠ¶æ€
    â†“
ç”ŸæˆAccess Token (15åˆ†é’Ÿ)
ç”ŸæˆRefresh Token (14å¤©)
    â†“
è¿”å›åŒToken
    â†“
åç»­è¯·æ±‚æºå¸¦Access Token
    â†“
JWTè¿‡æ»¤å™¨éªŒè¯Token
    â†“
æå–ç”¨æˆ·ä¿¡æ¯åˆ°SecurityContext
    â†“
è®¿é—®å—ä¿æŠ¤èµ„æº
```

### 2. JWT Tokenç»“æ„

```json
{
  "header": {
    "alg": "HS256",
    "typ": "JWT"
  },
  "payload": {
    "sub": "userId",
    "iat": 1234567890,
    "exp": 1234568790
  },
  "signature": "..."
}
```

### 3. å®‰å…¨é…ç½®

#### å¯†ç ç­–ç•¥
```java
@Bean
public PasswordEncoder passwordEncoder() {
    return new BCryptPasswordEncoder(12);  // 12è½®åŠ å¯†
}
```

#### è´¦æˆ·é”å®šç­–ç•¥
```java
// é…ç½®
MAX_FAILED_ATTEMPTS = 5
LOCK_DURATION_MINUTES = 30

// é€»è¾‘
if (failedAttempts >= 5) {
    lockUntil = now + 30 minutes
}
```

#### CORSé…ç½®
```java
@Configuration
public class CorsConfig {
    @Bean
    public CorsFilter corsFilter() {
        // å…è®¸çš„æºã€æ–¹æ³•ã€å¤´éƒ¨
        // æ”¯æŒå‡­è¯
        // æœ€å¤§ç¼“å­˜æ—¶é—´
    }
}
```

### 4. æ¥å£æƒé™

#### å…¬å¼€æ¥å£
```java
- POST /api/v1/auth/register    // æ³¨å†Œ
- POST /api/v1/auth/login       // ç™»å½•
- POST /api/v1/auth/refresh     // åˆ·æ–°Token
- POST /api/v1/auth/logout      // ç™»å‡º
- GET  /swagger-ui/**           // APIæ–‡æ¡£
- GET  /v3/api-docs/**          // OpenAPIè§„èŒƒ
```

#### å—ä¿æŠ¤æ¥å£
```java
// æ‰€æœ‰å…¶ä»–æ¥å£éƒ½éœ€è¦JWTè®¤è¯
Authorization: Bearer <access_token>
```

### 5. é™æµä¿æŠ¤

```java
@Service
public class RateLimiterService {
    // åŸºäºå†…å­˜çš„é™æµå®ç°
    // å¯é˜²æ­¢APIæ»¥ç”¨
}
```

### 6. è¾“å…¥éªŒè¯

```java
// ä½¿ç”¨Jakarta Validation
@NotNull
@NotBlank
@Size(min = 1, max = 100)
@Email
@E164Phone  // è‡ªå®šä¹‰ç”µè¯å·ç éªŒè¯
```

---

## AIé›†æˆ

### DeepSeek APIé›†æˆ

#### é…ç½®
```properties
deepseek.base-url=https://api.deepseek.com
deepseek.api-key=${DEEPSEEK_API_KEY}
deepseek.model=deepseek-chat
deepseek.reasoner-model=deepseek-reasoner
deepseek.timeout-ms=120000
deepseek.enable-logging=true
```

#### å®¢æˆ·ç«¯å®ç°
```java
@Service
public class DeepseekClient {
    private final WebClient webClient;
    
    public Mono<ChatCompletionResponse> chatCompletion(
        ChatCompletionRequest request
    ) {
        return webClient.post()
            .uri("/chat/completions")
            .header("Authorization", "Bearer " + apiKey)
            .bodyValue(request)
            .retrieve()
            .bodyToMono(ChatCompletionResponse.class);
    }
}
```

### AIæç¤ºè¯å·¥ç¨‹

ç³»ç»Ÿä½¿ç”¨ç²¾å¿ƒè®¾è®¡çš„Promptæ¨¡æ¿å®ç°å„ç§AIåŠŸèƒ½ï¼š

#### 1. ä¿¡æ¯æ”¶é›†Prompt
```java
public class PromptTemplates {
    public static String INFO_COLLECTION_SYSTEM = """
        ä½ æ˜¯ä¸€ä¸ªå–„äºå€¾å¬å’Œæé—®çš„AIåŠ©æ‰‹...
        ç›®æ ‡ï¼šé€šè¿‡è‡ªç„¶å¯¹è¯æ”¶é›†è”ç³»äººä¿¡æ¯
        è¦æ±‚ï¼š
        1. ä¸€æ¬¡åªé—®ä¸€ä¸ªé—®é¢˜
        2. æ ¹æ®å·²æœ‰ä¿¡æ¯è°ƒæ•´é—®é¢˜
        3. ä¿æŒå¯¹è¯è‡ªç„¶æµç•…
        """;
}
```

#### 2. ä¿¡æ¯æå–Prompt
```java
public static String EXTRACTION_PROMPT = """
    ä»ç”¨æˆ·å›ç­”ä¸­æå–ç»“æ„åŒ–ä¿¡æ¯
    è¿”å›JSONæ ¼å¼ï¼š
    {
      "name": "å§“å",
      "age": å¹´é¾„,
      "occupation": "èŒä¸š",
      "interests": ["å…´è¶£1", "å…´è¶£2"],
      ...
    }
    """;
```

#### 3. åˆ¤æ–­å®Œæ•´æ€§Prompt
```java
public static String COMPLETION_CHECK = """
    åˆ¤æ–­æ”¶é›†çš„ä¿¡æ¯æ˜¯å¦è¶³å¤Ÿå®Œæ•´
    è¿”å›ï¼š
    {
      "isComplete": true/false,
      "confidence": "HIGH/MEDIUM/LOW",
      "missingFields": ["ç¼ºå°‘çš„å­—æ®µ"]
    }
    """;
```

#### 4. å…³ç³»ç­–ç•¥ç”ŸæˆPrompt
```java
public static String GOAL_STRATEGY = """
    åŸºäºä»¥ä¸‹ä¿¡æ¯ç”Ÿæˆå…³ç³»æ”¹å–„ç­–ç•¥ï¼š
    - è”ç³»äººä¿¡æ¯ï¼š...
    - ç”¨æˆ·ç›®æ ‡ï¼š...
    - å½“å‰å…³ç³»çŠ¶æ€ï¼š...
    
    è¿”å›ï¼š
    {
      "strategy": "ç­–ç•¥æè¿°",
      "actionPlans": [
        {
          "title": "è¡ŒåŠ¨æ ‡é¢˜",
          "description": "è¯¦ç»†æè¿°",
          "suggestedTime": "å»ºè®®æ—¶é—´"
        }
      ]
    }
    """;
```

### AIåŠŸèƒ½çŸ©é˜µ

| åŠŸèƒ½ | ä½¿ç”¨åœºæ™¯ | AIæ¨¡å‹ | è¿”å›æ ¼å¼ |
|------|---------|--------|---------|
| ä¿¡æ¯æ”¶é›† | å¯¹è¯å¼•å¯¼ | deepseek-chat | è‡ªç„¶è¯­è¨€ |
| ä¿¡æ¯æå– | ç»“æ„åŒ–å­˜å‚¨ | deepseek-chat | JSON |
| å®Œæ•´æ€§åˆ¤æ–­ | ä¼šè¯æ§åˆ¶ | deepseek-chat | JSON |
| æ‘˜è¦ç”Ÿæˆ | ä¿¡æ¯æ€»ç»“ | deepseek-chat | è‡ªç„¶è¯­è¨€ |
| é—®ç­”ç³»ç»Ÿ | ç”¨æˆ·æé—® | deepseek-chat | è‡ªç„¶è¯­è¨€ |
| å…³ç³»æ´å¯Ÿ | Aibookç”Ÿæˆ | deepseek-chat | ç»“æ„åŒ–æ–‡æœ¬ |
| ç›®æ ‡ç­–ç•¥ | è¡ŒåŠ¨è®¡åˆ’ | deepseek-chat | JSON |

---

## APIæ¥å£

### ç»Ÿä¸€å“åº”æ ¼å¼

#### æˆåŠŸå“åº”
```json
{
  "success": true,
  "code": 200,
  "message": "Success",
  "data": { ... },
  "timestamp": "2025-10-19T12:00:00"
}
```

#### é”™è¯¯å“åº”
```json
{
  "success": false,
  "code": 400,
  "message": "Invalid input",
  "data": null,
  "timestamp": "2025-10-19T12:00:00"
}
```

### é”™è¯¯ç å®šä¹‰

```java
public enum ErrorCode {
    // é€šç”¨é”™è¯¯ (1000-1999)
    SUCCESS(200, "Success"),
    BAD_REQUEST(400, "Bad Request"),
    UNAUTHORIZED(401, "Unauthorized"),
    FORBIDDEN(403, "Forbidden"),
    NOT_FOUND(404, "Not Found"),
    INTERNAL_ERROR(500, "Internal Server Error"),
    
    // è®¤è¯é”™è¯¯ (2000-2099)
    AUTH_INVALID_CREDENTIALS(2001, "Invalid credentials"),
    AUTH_TOKEN_EXPIRED(2002, "Token expired"),
    AUTH_TOKEN_INVALID(2003, "Invalid token"),
    AUTH_USER_LOCKED(2004, "Account locked"),
    AUTH_PHONE_EXISTS(2005, "Phone already registered"),
    
    // ä¸šåŠ¡é”™è¯¯ (3000+)
    CONTACT_NOT_FOUND(3001, "Contact not found"),
    SESSION_NOT_FOUND(3002, "Session not found"),
    GOAL_NOT_FOUND(3003, "Goal not found"),
    RATE_LIMIT_EXCEEDED(3004, "Rate limit exceeded"),
    ...
}
```

### APIç‰ˆæœ¬ç®¡ç†

```
åŸºç¡€è·¯å¾„: /api/v1
ç‰ˆæœ¬ç­–ç•¥: URLç‰ˆæœ¬æ§åˆ¶
å½“å‰ç‰ˆæœ¬: v1
```

### æ ¸å¿ƒAPIç«¯ç‚¹

#### è®¤è¯ç›¸å…³
```http
POST   /api/v1/auth/register          # æ³¨å†Œ
POST   /api/v1/auth/login             # ç™»å½•
POST   /api/v1/auth/refresh           # åˆ·æ–°Token
POST   /api/v1/auth/logout            # ç™»å‡º
```

#### ç”¨æˆ·ç›¸å…³
```http
GET    /api/v1/users/me               # è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
PUT    /api/v1/users/me               # æ›´æ–°ç”¨æˆ·ä¿¡æ¯
PUT    /api/v1/users/me/password      # ä¿®æ”¹å¯†ç 
DELETE /api/v1/users/me               # åˆ é™¤è´¦æˆ·
```

#### è”ç³»äººç›¸å…³
```http
POST   /api/contacts                  # åˆ›å»ºè”ç³»äºº
GET    /api/contacts                  # è·å–è”ç³»äººåˆ—è¡¨
GET    /api/contacts/{id}             # è·å–è”ç³»äººè¯¦æƒ…
PUT    /api/contacts/{id}             # æ›´æ–°è”ç³»äºº
DELETE /api/contacts/{id}             # åˆ é™¤è”ç³»äºº
POST   /api/contacts/{id}/aibook      # ç”Ÿæˆå…³ç³»æ´å¯Ÿ
POST   /api/contacts/aibook/preview   # é¢„è§ˆAibook
```

#### å¯¹è¯ç›¸å…³
```http
# è”ç³»äººä¿¡æ¯æ”¶é›†
POST   /api/conversations/start                    # å¼€å§‹æ”¶é›†
POST   /api/conversations/{sessionId}/message      # å‘é€æ¶ˆæ¯
GET    /api/conversations/{sessionId}/history      # è·å–å†å²

# è”ç³»äººé—®ç­”
POST   /api/qa/start                               # å¼€å§‹é—®ç­”
POST   /api/qa/{sessionId}/ask                     # æé—®
POST   /api/qa/{sessionId}/supplement              # è¡¥å……ä¿¡æ¯
GET    /api/qa/{sessionId}/history                 # è·å–å†å²

# ç”¨æˆ·è‡ªæˆ‘å¯¹è¯
POST   /api/user-conversations/start               # å¼€å§‹æ”¶é›†
POST   /api/user-conversations/{sessionId}/message # å‘é€æ¶ˆæ¯
POST   /api/user-qa/start                          # å¼€å§‹é—®ç­”
POST   /api/user-qa/{sessionId}/ask                # æé—®
```

#### ç›®æ ‡ç›¸å…³
```http
POST   /api/goals                                  # åˆ›å»ºç›®æ ‡
GET    /api/goals                                  # è·å–ç›®æ ‡åˆ—è¡¨
GET    /api/goals/{goalId}                         # è·å–ç›®æ ‡è¯¦æƒ…
DELETE /api/goals/{goalId}                         # åˆ é™¤ç›®æ ‡

# è¡ŒåŠ¨è®¡åˆ’
PUT    /api/goals/{goalId}/plans/{planId}/adopt    # é‡‡çº³è®¡åˆ’
PUT    /api/goals/{goalId}/plans/{planId}/unadopt  # å–æ¶ˆé‡‡çº³
PUT    /api/goals/{goalId}/plans/{planId}/status   # æ›´æ–°çŠ¶æ€
PUT    /api/goals/{goalId}/plans/{planId}/time     # ä¿®æ”¹æ—¶é—´
```

#### Pinç›¸å…³
```http
POST   /api/pins                      # åˆ›å»ºPin
GET    /api/pins                      # è·å–Pinåˆ—è¡¨
GET    /api/pins/{pinId}              # è·å–Pinè¯¦æƒ…
PUT    /api/pins/{pinId}              # æ›´æ–°Pin
DELETE /api/pins/{pinId}              # åˆ é™¤Pin
```

#### æ¨é€ç›¸å…³
```http
POST   /api/push/register             # æ³¨å†Œè®¾å¤‡Token
DELETE /api/push/unregister           # æ³¨é”€è®¾å¤‡Token
```

### APIæ–‡æ¡£

ç³»ç»Ÿé›†æˆäº†Swagger UIï¼Œå¯é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š

```
Swagger UI: http://localhost:8080/swagger-ui
OpenAPI Spec: http://localhost:8080/v3/api-docs
```

---

## é…ç½®è¯´æ˜

### ç¯å¢ƒé…ç½®

ç³»ç»Ÿæ”¯æŒå¤šç¯å¢ƒé…ç½®ï¼š

- `application.properties` - é»˜è®¤é…ç½®
- `application-dev.properties` - å¼€å‘ç¯å¢ƒ
- `application-prod.properties` - ç”Ÿäº§ç¯å¢ƒï¼ˆéœ€åˆ›å»ºï¼‰
- `application-test.properties` - æµ‹è¯•ç¯å¢ƒ

### ç¯å¢ƒå˜é‡

#### å¿…éœ€ç¯å¢ƒå˜é‡
```bash
# æ•°æ®åº“
DB_USERNAME=your_db_username
DB_PASSWORD=your_db_password

# JWT
JWT_SECRET=your_secure_secret_key_at_least_32_chars

# DeepSeek API
DEEPSEEK_API_KEY=your_deepseek_api_key

# Firebase (æ¨é€é€šçŸ¥)
FIREBASE_CONFIG_PATH=/path/to/firebase-service-account.json
```

#### å¯é€‰ç¯å¢ƒå˜é‡
```bash
# æœåŠ¡å™¨
SERVER_PORT=8080

# æ•°æ®åº“URL
SPRING_DATASOURCE_URL=jdbc:mysql://localhost:3306/relationship_app

# æ—¥å¿—çº§åˆ«
LOGGING_LEVEL_ROOT=INFO
```

### å¼€å‘ç¯å¢ƒé…ç½® (application-dev.properties)

```properties
# H2å†…å­˜æ•°æ®åº“
spring.datasource.url=jdbc:h2:mem:testdb;MODE=MySQL
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=

# JPA
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=false

# Flyway
spring.flyway.enabled=true

# JWT
security.jwt.access-token-validity-minutes=15
security.jwt.refresh-token-validity-days=14

# DeepSeek
deepseek.timeout-ms=120000
deepseek.enable-logging=true

# æé†’
reminder.advance-minutes=15
reminder.scheduler.cron=0 * * * * *
```

### ç”Ÿäº§ç¯å¢ƒé…ç½®å»ºè®®

```properties
# ä½¿ç”¨ç¯å¢ƒå˜é‡
spring.datasource.url=${DB_URL}
spring.datasource.username=${DB_USERNAME}
spring.datasource.password=${DB_PASSWORD}

# å…³é—­SQLæ—¥å¿—
spring.jpa.show-sql=false

# ç”Ÿäº§çº§åˆ«æ—¥å¿—
logging.level.root=WARN
logging.level.com.ulog.backend=INFO

# æ•°æ®åº“è¿æ¥æ± 
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000

# ç”Ÿäº§ç¯å¢ƒJWT
security.jwt.access-token-validity-minutes=15
security.jwt.refresh-token-validity-days=14
```

---

## éƒ¨ç½²æŒ‡å—

### 1. å‰ç½®è¦æ±‚

#### ç³»ç»Ÿè¦æ±‚
- Java 17+
- Maven 3.6+
- MySQL 8.0+

#### å¤–éƒ¨æœåŠ¡
- DeepSeek APIè´¦æˆ·å’Œå¯†é’¥
- Firebaseé¡¹ç›®å’ŒæœåŠ¡è´¦æˆ·å¯†é’¥
- ï¼ˆå¯é€‰ï¼‰åå‘ä»£ç†ï¼ˆNginxï¼‰

### 2. æ•°æ®åº“å‡†å¤‡

```sql
-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE relationship_app 
  CHARACTER SET utf8mb4 
  COLLATE utf8mb4_unicode_ci;

-- åˆ›å»ºç”¨æˆ·
CREATE USER 'ulog'@'localhost' IDENTIFIED BY 'your_password';

-- æˆæƒ
GRANT ALL PRIVILEGES ON relationship_app.* TO 'ulog'@'localhost';
FLUSH PRIVILEGES;
```

### 3. æ„å»ºé¡¹ç›®

```bash
# å…‹éš†é¡¹ç›®
git clone <repository-url>
cd backend

# é…ç½®ç¯å¢ƒå˜é‡
export DB_USERNAME=ulog
export DB_PASSWORD=your_password
export JWT_SECRET=your_secure_secret_key_minimum_32_characters
export DEEPSEEK_API_KEY=sk-your-key
export FIREBASE_CONFIG_PATH=/path/to/firebase-service-account.json

# æ„å»º
mvn clean package -DskipTests

# è¾“å‡ºä½ç½®
# target/backend-0.0.1-SNAPSHOT.jar
```

### 4. è¿è¡Œåº”ç”¨

#### å¼€å‘æ¨¡å¼
```bash
# ä½¿ç”¨Maven
mvn spring-boot:run -Dspring-boot.run.profiles=dev

# æˆ–ä½¿ç”¨jar
java -jar target/backend-0.0.1-SNAPSHOT.jar --spring.profiles.active=dev
```

#### ç”Ÿäº§æ¨¡å¼
```bash
java -jar \
  -Dspring.profiles.active=prod \
  -Xms512m \
  -Xmx2g \
  target/backend-0.0.1-SNAPSHOT.jar
```

### 5. ä½¿ç”¨Dockeréƒ¨ç½²

#### Dockerfile
```dockerfile
FROM openjdk:17-slim

WORKDIR /app

COPY target/backend-0.0.1-SNAPSHOT.jar app.jar

EXPOSE 8080

ENV JAVA_OPTS="-Xms512m -Xmx2g"

ENTRYPOINT ["sh", "-c", "java $JAVA_OPTS -jar app.jar"]
```

#### docker-compose.yml
```yaml
version: '3.8'

services:
  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_DATABASE: relationship_app
      MYSQL_USER: ulog
      MYSQL_PASSWORD: password
    ports:
      - "3306:3306"
    volumes:
      - mysql-data:/var/lib/mysql

  backend:
    build: .
    ports:
      - "8080:8080"
    environment:
      SPRING_PROFILES_ACTIVE: prod
      DB_URL: jdbc:mysql://mysql:3306/relationship_app
      DB_USERNAME: ulog
      DB_PASSWORD: password
      JWT_SECRET: ${JWT_SECRET}
      DEEPSEEK_API_KEY: ${DEEPSEEK_API_KEY}
      FIREBASE_CONFIG_PATH: /app/config/firebase-service-account.json
    volumes:
      - ./firebase-service-account.json:/app/config/firebase-service-account.json
    depends_on:
      - mysql

volumes:
  mysql-data:
```

### 6. Nginxåå‘ä»£ç†é…ç½®

```nginx
server {
    listen 80;
    server_name api.yourdomain.com;

    location / {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # WebSocketæ”¯æŒï¼ˆå¦‚æœéœ€è¦ï¼‰
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
```

### 7. å¥åº·æ£€æŸ¥

```bash
# æ£€æŸ¥åº”ç”¨çŠ¶æ€
curl http://localhost:8080/actuator/health

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
curl http://localhost:8080/actuator/health/db
```

### 8. æ—¥å¿—ç®¡ç†

```bash
# æ—¥å¿—æ–‡ä»¶ä½ç½®
logs/application.log

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
tail -f logs/application.log

# æœç´¢é”™è¯¯
grep "ERROR" logs/application.log
```

---

## å¼€å‘è§„èŒƒ

### ä»£ç ç»“æ„è§„èŒƒ

#### åŒ…å‘½åè§„èŒƒ
```
com.ulog.backend
  â”œâ”€â”€ domain/          # é¢†åŸŸæ¨¡å‹ï¼ˆå®ä½“ï¼‰
  â”œâ”€â”€ repository/      # æ•°æ®è®¿é—®å±‚
  â”œâ”€â”€ service/         # ä¸šåŠ¡é€»è¾‘å±‚
  â”œâ”€â”€ controller/      # æ§åˆ¶å™¨å±‚
  â”œâ”€â”€ dto/             # æ•°æ®ä¼ è¾“å¯¹è±¡
  â”œâ”€â”€ config/          # é…ç½®ç±»
  â”œâ”€â”€ security/        # å®‰å…¨ç›¸å…³
  â”œâ”€â”€ util/            # å·¥å…·ç±»
  â””â”€â”€ exception/       # å¼‚å¸¸ç±»
```

#### å®ä½“ç±»è§„èŒƒ
```java
@Entity
@Table(name = "users")
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long uid;
    
    // å­—æ®µ
    
    @Column(name = "created_at")
    private LocalDateTime createdAt;
    
    @Column(name = "updated_at")
    private LocalDateTime updatedAt;
    
    // è½¯åˆ é™¤
    @Column(name = "deleted")
    private Boolean deleted = false;
}
```

#### æœåŠ¡ç±»è§„èŒƒ
```java
public interface UserService {
    User createUser(CreateUserRequest request);
    User getUserById(Long id);
    User updateUser(Long id, UpdateUserRequest request);
    void deleteUser(Long id);
}

@Service
@RequiredArgsConstructor
public class UserServiceImpl implements UserService {
    private final UserRepository userRepository;
    
    @Override
    @Transactional
    public User createUser(CreateUserRequest request) {
        // å®ç°
    }
}
```

#### æ§åˆ¶å™¨è§„èŒƒ
```java
@RestController
@RequestMapping("/api/users")
@RequiredArgsConstructor
@Tag(name = "User", description = "ç”¨æˆ·ç®¡ç†API")
public class UserController {
    
    private final UserService userService;
    
    @GetMapping("/{id}")
    @Operation(summary = "è·å–ç”¨æˆ·ä¿¡æ¯")
    public ApiResponse<UserResponse> getUser(
        @PathVariable Long id
    ) {
        User user = userService.getUserById(id);
        return ApiResponse.success(toResponse(user));
    }
}
```

### å‘½åè§„èŒƒ

#### ç±»å‘½å
```
å®ä½“ç±»:     User, Contact, Goal
DTO:        UserRequest, UserResponse, CreateUserRequest
Service:    UserService, UserServiceImpl
Controller: UserController
Repository: UserRepository
```

#### æ–¹æ³•å‘½å
```
æŸ¥è¯¢:  getXxx, findXxx, listXxx, queryXxx
åˆ›å»º:  createXxx, addXxx
æ›´æ–°:  updateXxx, modifyXxx
åˆ é™¤:  deleteXxx, removeXxx
åˆ¤æ–­:  isXxx, hasXxx, canXxx
```

### å¼‚å¸¸å¤„ç†è§„èŒƒ

```java
// è‡ªå®šä¹‰å¼‚å¸¸
@Getter
public class ApiException extends RuntimeException {
    private final ErrorCode errorCode;
    
    public ApiException(ErrorCode errorCode) {
        super(errorCode.getMessage());
        this.errorCode = errorCode;
    }
}

// å…¨å±€å¼‚å¸¸å¤„ç†
@RestControllerAdvice
public class GlobalExceptionHandler {
    
    @ExceptionHandler(ApiException.class)
    public ApiResponse<?> handleApiException(ApiException e) {
        return ApiResponse.error(e.getErrorCode());
    }
    
    @ExceptionHandler(Exception.class)
    public ApiResponse<?> handleException(Exception e) {
        log.error("Unexpected error", e);
        return ApiResponse.error(ErrorCode.INTERNAL_ERROR);
    }
}
```

### æ—¥å¿—è§„èŒƒ

```java
@Slf4j
public class SomeService {
    
    public void someMethod() {
        log.info("Starting process for user: {}", userId);
        
        try {
            // ä¸šåŠ¡é€»è¾‘
            log.debug("Processing step 1");
            
        } catch (Exception e) {
            log.error("Error processing user: {}", userId, e);
            throw new ApiException(ErrorCode.INTERNAL_ERROR);
        }
        
        log.info("Process completed successfully");
    }
}
```

### Gitæäº¤è§„èŒƒ

```
feat:     æ–°åŠŸèƒ½
fix:      ä¿®å¤bug
docs:     æ–‡æ¡£æ›´æ–°
style:    ä»£ç æ ¼å¼è°ƒæ•´
refactor: é‡æ„
test:     æµ‹è¯•ç›¸å…³
chore:    æ„å»º/å·¥å…·å˜åŠ¨

ç¤ºä¾‹:
feat: æ·»åŠ å…³ç³»ç›®æ ‡ç®¡ç†åŠŸèƒ½
fix: ä¿®å¤JWT tokenè¿‡æœŸåˆ¤æ–­é€»è¾‘
docs: æ›´æ–°APIæ–‡æ¡£
refactor: é‡æ„ç”¨æˆ·è®¤è¯æµç¨‹
```

### æµ‹è¯•è§„èŒƒ

```java
@SpringBootTest
@Transactional
class UserServiceTest extends AbstractIntegrationTest {
    
    @Autowired
    private UserService userService;
    
    @Test
    @DisplayName("åˆ›å»ºç”¨æˆ· - æˆåŠŸ")
    void testCreateUser_Success() {
        // Given
        CreateUserRequest request = new CreateUserRequest();
        request.setPhone("+8613800138000");
        request.setPassword("Password123");
        
        // When
        User user = userService.createUser(request);
        
        // Then
        assertNotNull(user.getUid());
        assertEquals(request.getPhone(), user.getPhone());
    }
    
    @Test
    @DisplayName("åˆ›å»ºç”¨æˆ· - æ‰‹æœºå·é‡å¤")
    void testCreateUser_DuplicatePhone() {
        // Given
        // å‡†å¤‡æµ‹è¯•æ•°æ®
        
        // When & Then
        assertThrows(ApiException.class, () -> {
            userService.createUser(request);
        });
    }
}
```

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. æ•°æ®åº“ä¼˜åŒ–

```sql
-- æ·»åŠ åˆé€‚çš„ç´¢å¼•
CREATE INDEX idx_user_phone ON users(phone);
CREATE INDEX idx_contact_owner ON contacts(owner_uid, deleted);

-- å®šæœŸæ¸…ç†è½¯åˆ é™¤æ•°æ®
DELETE FROM contacts WHERE deleted = 1 AND updated_at < DATE_SUB(NOW(), INTERVAL 90 DAY);

-- ä½¿ç”¨æ•°æ®åº“è¿æ¥æ± 
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
```

### 2. ç¼“å­˜ç­–ç•¥

```java
// å¯æ·»åŠ Redisç¼“å­˜
@Cacheable(value = "users", key = "#id")
public User getUserById(Long id) {
    return userRepository.findById(id)
        .orElseThrow(() -> new NotFoundException("User not found"));
}

@CacheEvict(value = "users", key = "#id")
public void updateUser(Long id, UpdateUserRequest request) {
    // æ›´æ–°é€»è¾‘
}
```

### 3. å¼‚æ­¥å¤„ç†

```java
@Async
public CompletableFuture<Void> sendPushNotification(
    Long userId, String title, String body
) {
    // å¼‚æ­¥å‘é€æ¨é€
    return CompletableFuture.completedFuture(null);
}
```

### 4. æ‰¹é‡æ“ä½œ

```java
// æ‰¹é‡æ’å…¥
@Transactional
public void createReminders(List<Reminder> reminders) {
    reminderRepository.saveAll(reminders);
}
```

---

## ç›‘æ§å’Œç»´æŠ¤

### 1. åº”ç”¨ç›‘æ§

```properties
# å¯ç”¨Actuator
management.endpoints.web.exposure.include=health,info,metrics

# ç«¯ç‚¹
/actuator/health     # å¥åº·æ£€æŸ¥
/actuator/info       # åº”ç”¨ä¿¡æ¯
/actuator/metrics    # æŒ‡æ ‡ç›‘æ§
```

### 2. æ—¥å¿—ç›‘æ§

```bash
# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -f logs/application.log | grep ERROR

# æŸ¥çœ‹æ…¢æŸ¥è¯¢
tail -f logs/application.log | grep "took longer than"
```

### 3. æ•°æ®åº“ç»´æŠ¤

```sql
-- æ£€æŸ¥è¡¨å¤§å°
SELECT 
  table_name,
  ROUND(((data_length + index_length) / 1024 / 1024), 2) AS "Size (MB)"
FROM information_schema.TABLES 
WHERE table_schema = "relationship_app"
ORDER BY (data_length + index_length) DESC;

-- ä¼˜åŒ–è¡¨
OPTIMIZE TABLE users, contacts, conversation_sessions;
```

### 4. å¤‡ä»½ç­–ç•¥

```bash
# æ•°æ®åº“å¤‡ä»½
mysqldump -u root -p relationship_app > backup_$(date +%Y%m%d).sql

# è‡ªåŠ¨å¤‡ä»½è„šæœ¬
0 2 * * * /path/to/backup.sh
```

---

## æ‰©å±•åŠŸèƒ½å»ºè®®

### æœªæ¥å¯èƒ½çš„åŠŸèƒ½æ‰©å±•

1. **å…³ç³»ç½‘ç»œå›¾è°±**
   - å¯è§†åŒ–è”ç³»äººå…³ç³»ç½‘ç»œ
   - å…³ç³»å¼ºåº¦åˆ†æ
   - ç¤¾äº¤åœˆå­åˆ’åˆ†

2. **æ™ºèƒ½æé†’ä¼˜åŒ–**
   - åŸºäºç”¨æˆ·ä¹ æƒ¯çš„æ™ºèƒ½æé†’æ—¶é—´
   - æé†’æ•ˆæœè¿½è¸ª
   - è‡ªé€‚åº”æé†’é¢‘ç‡

3. **æ•°æ®åˆ†æå’ŒæŠ¥å‘Š**
   - å…³ç³»è´¨é‡è¶‹åŠ¿åˆ†æ
   - äº’åŠ¨é¢‘ç‡ç»Ÿè®¡
   - ä¸ªäººå…³ç³»å¥åº·åº¦è¯„åˆ†

4. **å¤šç«¯åŒæ­¥**
   - å®æ—¶æ¶ˆæ¯åŒæ­¥
   - ç¦»çº¿æ•°æ®ç¼“å­˜
   - å†²çªè§£å†³æœºåˆ¶

5. **ç¤¾äº¤åŠŸèƒ½**
   - å…³ç³»å»ºè®®æ¨è
   - ç»éªŒåˆ†äº«ç¤¾åŒº
   - åŒ¿åå’¨è¯¢åŠŸèƒ½

6. **é«˜çº§AIåŠŸèƒ½**
   - æƒ…æ„Ÿåˆ†æ
   - æ€§æ ¼åŒ¹é…åº¦åˆ†æ
   - æ²Ÿé€šé£æ ¼å»ºè®®

---

## å¸¸è§é—®é¢˜ (FAQ)

### Q1: å¦‚ä½•é‡ç½®JWTå¯†é’¥ï¼Ÿ
```bash
# ç”Ÿæˆæ–°çš„å¯†é’¥
openssl rand -base64 32

# æ›´æ–°ç¯å¢ƒå˜é‡
export JWT_SECRET=new_secret_key

# é‡å¯åº”ç”¨
```

### Q2: æ•°æ®åº“è¿ç§»å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
```sql
-- æŸ¥çœ‹Flywayå†å²
SELECT * FROM flyway_schema_history;

-- ä¿®å¤å¤±è´¥çš„è¿ç§»
DELETE FROM flyway_schema_history WHERE success = 0;

-- é‡æ–°è¿è¡Œåº”ç”¨
```

### Q3: å¦‚ä½•æ¸…ç†è¿‡æœŸçš„RefreshTokenï¼Ÿ
```java
@Scheduled(cron = "0 0 2 * * *")  // æ¯å¤©å‡Œæ™¨2ç‚¹
public void cleanExpiredTokens() {
    refreshTokenRepository.deleteByExpiresAtBefore(LocalDateTime.now());
}
```

### Q4: DeepSeek APIè°ƒç”¨è¶…æ—¶æ€ä¹ˆåŠï¼Ÿ
```properties
# å¢åŠ è¶…æ—¶æ—¶é—´
deepseek.timeout-ms=180000  # 3åˆ†é’Ÿ

# æ·»åŠ é‡è¯•æœºåˆ¶
@Retry(maxAttempts = 3, backoff = @Backoff(delay = 1000))
```

### Q5: å¦‚ä½•æ›´æ¢æ•°æ®åº“ï¼Ÿ
```properties
# æ”¯æŒå…¶ä»–æ•°æ®åº“ï¼Œåªéœ€ä¿®æ”¹é…ç½®
# PostgreSQL
spring.datasource.url=jdbc:postgresql://localhost:5432/relationship_app
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
```

---

## æŠ€æœ¯æ”¯æŒå’Œè´¡çŒ®

### é¡¹ç›®æ–‡æ¡£
- APIæ–‡æ¡£: `http://localhost:8080/swagger-ui`
- å¿«é€Ÿå¼€å§‹: [QUICK_START_GUIDE.md](QUICK_START_GUIDE.md)
- å…³ç³»ç›®æ ‡: [RELATIONSHIP_GOALS_README.md](RELATIONSHIP_GOALS_README.md)
- PinåŠŸèƒ½: [PIN_FEATURE_README.md](PIN_FEATURE_README.md)

### å¼€å‘å›¢é˜Ÿ
- é¡¹ç›®ç»´æŠ¤è€…: Ulog Team
- æŠ€æœ¯æ ˆ: Java 17, Spring Boot 3.x, MySQL 8.x, AI (Deepseek)

### ç‰ˆæœ¬å†å²
- v0.0.1: åˆå§‹ç‰ˆæœ¬
  - ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
  - è”ç³»äººç®¡ç†
  - å¯¹è¯å¼ä¿¡æ¯æ”¶é›†
  - æ™ºèƒ½é—®ç­”ç³»ç»Ÿ
  - å…³ç³»ç›®æ ‡ç®¡ç†
  - Pinæ”¶è—åŠŸèƒ½
  - æ¨é€é€šçŸ¥

---

## é™„å½•

### A. å®Œæ•´çš„ç¯å¢ƒå˜é‡æ¸…å•

```bash
# æ•°æ®åº“
DB_USERNAME=your_db_user
DB_PASSWORD=your_db_password
DB_URL=jdbc:mysql://localhost:3306/relationship_app

# JWT
JWT_SECRET=your_jwt_secret_minimum_32_characters

# DeepSeek
DEEPSEEK_API_KEY=sk-your-deepseek-api-key

# Firebase
FIREBASE_CONFIG_PATH=/path/to/firebase-service-account.json

# æœåŠ¡å™¨
SERVER_PORT=8080
SPRING_PROFILES_ACTIVE=prod

# æ—¥å¿—
LOGGING_LEVEL_ROOT=INFO
```

### B. æ•°æ®åº“ERå›¾æ¦‚è¦

```
users (ç”¨æˆ·)
  â”œâ”€â”€ contacts (è”ç³»äºº)
  â”‚     â”œâ”€â”€ conversation_sessions (å¯¹è¯ä¼šè¯)
  â”‚     â”œâ”€â”€ relationship_goals (å…³ç³»ç›®æ ‡)
  â”‚     â”‚     â””â”€â”€ action_plans (è¡ŒåŠ¨è®¡åˆ’)
  â”‚     â”‚           â””â”€â”€ reminders (æé†’)
  â”‚     â””â”€â”€ pins (Pinæ”¶è—)
  â”œâ”€â”€ user_conversation_sessions (ç”¨æˆ·å¯¹è¯ä¼šè¯)
  â”œâ”€â”€ pins (Pinæ”¶è—)
  â”œâ”€â”€ refresh_tokens (åˆ·æ–°Token)
  â””â”€â”€ user_push_tokens (æ¨é€Token)
```

### C. APIè¯·æ±‚ç¤ºä¾‹é›†åˆ

å®Œæ•´çš„Postmané›†åˆè¯·å‚è€ƒï¼š
- [complete_integrated_postman_collection.json](complete_integrated_postman_collection.json)
- [relationship_goals_api_examples.json](relationship_goals_api_examples.json)

### D. ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Mobile App â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ HTTPS
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Nginx     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Spring Boot Application     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Security Layer (JWT)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Controller Layer        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Service Layer           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Repository Layer        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“           â†“              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MySQL  â”‚  â”‚ Deepseek â”‚  â”‚Firebase â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   API    â”‚  â”‚   FCM   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç»“è¯­

è¿™ä»½æŠ€æœ¯è¯´æ˜æ–‡æ¡£æ¶µç›–äº†Relationship Management Backendç³»ç»Ÿçš„æ ¸å¿ƒæŠ€æœ¯æ¶æ„ã€åŠŸèƒ½æ¨¡å—ã€æ•°æ®åº“è®¾è®¡ã€å®‰å…¨æœºåˆ¶ã€AIé›†æˆã€APIæ¥å£ã€é…ç½®ã€éƒ¨ç½²å’Œå¼€å‘è§„èŒƒç­‰å„ä¸ªæ–¹é¢ã€‚

è¯¥ç³»ç»Ÿæ˜¯ä¸€ä¸ªåŸºäºAIé©±åŠ¨çš„ç°ä»£åŒ–å…³ç³»ç®¡ç†å¹³å°ï¼Œé€šè¿‡Spring Boot 3.xã€JWTè®¤è¯ã€Deepseek AIé›†æˆã€Firebaseæ¨é€ç­‰æŠ€æœ¯ï¼Œä¸ºç”¨æˆ·æä¾›æ™ºèƒ½åŒ–çš„äººé™…å…³ç³»ç®¡ç†æœåŠ¡ã€‚

### æ ¸å¿ƒä¼˜åŠ¿
1. **AIé©±åŠ¨**: æ·±åº¦é›†æˆDeepseek AIï¼Œæä¾›æ™ºèƒ½å¯¹è¯ã€ä¿¡æ¯æå–ã€ç­–ç•¥ç”Ÿæˆç­‰åŠŸèƒ½
2. **å®‰å…¨å¯é **: JWTåŒTokenæœºåˆ¶ã€BCryptåŠ å¯†ã€è´¦æˆ·é”å®šä¿æŠ¤
3. **æ¨¡å—åŒ–è®¾è®¡**: æ¸…æ™°çš„åˆ†å±‚æ¶æ„ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
4. **å®Œå–„çš„æ•°æ®ç®¡ç†**: Flywayç‰ˆæœ¬æ§åˆ¶ï¼Œè½¯åˆ é™¤æœºåˆ¶
5. **å®æ—¶æé†’**: Firebaseæ¨é€é€šçŸ¥ï¼Œå®šæ—¶ä»»åŠ¡è°ƒåº¦
6. **RESTful API**: æ ‡å‡†åŒ–çš„APIè®¾è®¡ï¼Œå®Œæ•´çš„Swaggeræ–‡æ¡£

ç³»ç»Ÿå·²å…·å¤‡ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²èƒ½åŠ›ï¼Œå¯æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œå®šåˆ¶åŒ–å¼€å‘å’ŒåŠŸèƒ½æ‰©å±•ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æ›´æ–°æ—¥æœŸ**: 2025-10-19  
**æŠ€æœ¯æ ˆç‰ˆæœ¬**: Spring Boot 3.5.6, Java 17, MySQL 8.0

