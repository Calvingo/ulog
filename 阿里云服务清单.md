# 阿里云服务使用清单

> **项目名称**: ULog人际关系管理应用  
> **文档版本**: v1.0  
> **更新日期**: 2025年10月22日

---

## 📑 目录

1. [核心业务服务](#1-核心业务服务)
2. [基础设施服务](#2-基础设施服务)
3. [安全与合规服务](#3-安全与合规服务)
4. [运维监控服务](#4-运维监控服务)
5. [数据服务](#5-数据服务)
6. [备案与资质服务](#6-备案与资质服务)
7. [成本预算](#7-成本预算)
8. [实施路线图](#8-实施路线图)

---

## 1. 核心业务服务

### 1.1 阿里云短信服务（SMS）

**状态**: ⚠️ 必须实现

**用途**:
- 用户注册手机验证码
- 登录验证码
- 密码找回验证码
- 重要操作二次验证

**当前代码位置**:
- `backend/src/main/java/com/ulog/backend/auth/service/SmsCodeService.java`
- 当前使用固定验证码 "123456"，需要替换为真实短信服务

**技术实现**:
```xml
<!-- Maven依赖 -->
<dependency>
    <groupId>com.aliyun</groupId>
    <artifactId>dysmsapi20170525</artifactId>
    <version>2.0.24</version>
</dependency>
```

**所需配置**:
```properties
aliyun.sms.access-key-id=${ALIYUN_ACCESS_KEY_ID}
aliyun.sms.access-key-secret=${ALIYUN_ACCESS_KEY_SECRET}
aliyun.sms.sign-name=ULog应用
aliyun.sms.template.register=SMS_xxxxx  # 注册模板
aliyun.sms.template.login=SMS_xxxxx     # 登录模板
aliyun.sms.template.reset=SMS_xxxxx     # 密码重置模板
aliyun.sms.region-id=cn-hangzhou
```

**费用预估**:
- 价格: ¥0.03-0.06/条
- 预计月用量（1000用户）: 5,000-10,000条
- 月度费用: ¥150-600

**产品链接**: https://www.aliyun.com/product/sms

---

### 1.2 阿里云内容安全（原绿网）

**状态**: ⚠️ 已预留接口，必须实现

**用途**:
- AI对话内容审核（Deepseek返回内容）
- 用户输入内容过滤
- 联系人信息审核
- 用户生成内容实时检测

**当前代码位置**:
- `backend/src/main/java/com/ulog/backend/compliance/service/ContentModerationService.java`
- Line 109-114: `moderateWithAliyun()` 方法待实现

**审核范围**:
- 文本反垃圾（垃圾、广告、灌水）
- 敏感人物识别
- 暴恐涉政内容检测
- 违法违规内容检测
- 色情低俗内容检测
- 辱骂内容检测

**技术实现**:
```xml
<!-- Maven依赖 -->
<dependency>
    <groupId>com.aliyun</groupId>
    <artifactId>green20220302</artifactId>
    <version>2.0.10</version>
</dependency>
```

**所需配置**:
```properties
content.moderation.enabled=true
content.moderation.provider=aliyun
content.moderation.api-key=${ALIYUN_ACCESS_KEY_ID}
content.moderation.api-secret=${ALIYUN_ACCESS_KEY_SECRET}
content.moderation.endpoint=green.cn-shanghai.aliyuncs.com
content.moderation.timeout-ms=5000
```

**费用预估**:
- 价格: ¥0.015-0.025/次（文本）
- 预计日调用量: 5,000-20,000次
- 月度费用: ¥2,250-15,000

**产品链接**: https://www.aliyun.com/product/lvwang

---

### 1.3 阿里云实人认证（CloudAuth）

**状态**: ❌ 未实现，上架必需

**用途**:
- 用户实名认证（应用商店要求）
- 高风险操作验证
- 账号安全验证
- 符合《网络安全法》要求

**认证方式**:
1. **身份证二要素验证**
   - 姓名 + 身份证号
   - 价格: ¥0.3-0.5/次

2. **身份证三要素验证**
   - 姓名 + 身份证号 + 手机号
   - 价格: ¥0.8-1.2/次

3. **人脸识别实人认证**
   - 身份证 + 活体检测
   - 价格: ¥1.5-3.0/次

4. **银行卡四要素验证**（可选）
   - 姓名 + 身份证 + 银行卡号 + 手机号
   - 价格: ¥1.0-2.0/次

**技术实现**:
```xml
<!-- Maven依赖 -->
<dependency>
    <groupId>com.aliyun</groupId>
    <artifactId>cloudauth20190307</artifactId>
    <version>2.0.7</version>
</dependency>
```

**所需配置**:
```properties
aliyun.auth.access-key-id=${ALIYUN_ACCESS_KEY_ID}
aliyun.auth.access-key-secret=${ALIYUN_ACCESS_KEY_SECRET}
aliyun.auth.region-id=cn-hangzhou
aliyun.auth.scene=FVBioOnly  # 人脸识别场景
aliyun.auth.cert-type=IDENTITY_CARD
```

**需要创建的服务**:
```java
// backend/src/main/java/com/ulog/backend/auth/service/RealNameAuthService.java
@Service
public class RealNameAuthService {
    // 实名认证逻辑
}
```

**费用预估**:
- 假设20%用户完成实名认证
- 月度新增用户: 200人
- 实名认证用户: 40人
- 月度费用: ¥60-120（二要素）或 ¥60-120（人脸识别）

**产品链接**: https://www.aliyun.com/product/cloudauth

---

### 1.4 阿里云语音服务（可选）

**状态**: ⭕ 可选功能

**用途**:
- 语音验证码（短信触达率低时的备选）
- 语音通知（重要提醒）
- 语音交互功能（未来扩展）

**费用预估**:
- 价格: ¥0.09-0.15/分钟
- 建议优先级: P3（低）

**产品链接**: https://www.aliyun.com/product/vms

---

## 2. 基础设施服务

### 2.1 云服务器 ECS

**状态**: ✅ 生产环境必需

**用途**:
- 部署Spring Boot后端应用
- 运行MySQL数据库（或使用RDS）
- 运行Redis缓存（或使用Redis服务）

**推荐配置**:

**开发/测试环境**:
- 规格: ecs.t6-c1m2.large（2核4G）
- 带宽: 3Mbps
- 系统盘: 40GB SSD
- 操作系统: Ubuntu 22.04 LTS 或 CentOS 7.9
- 月度费用: ¥100-150

**生产环境（初期）**:
- 规格: ecs.c6.xlarge（4核8G）
- 带宽: 5Mbps
- 系统盘: 100GB ESSD
- 数据盘: 500GB ESSD（数据库存储）
- 月度费用: ¥600-800

**生产环境（扩容后）**:
- 2台应用服务器 + 负载均衡
- 规格: ecs.c6.2xlarge（8核16G）× 2
- 月度费用: ¥2,400-3,000

**产品链接**: https://www.aliyun.com/product/ecs

---

### 2.2 云数据库 RDS MySQL

**状态**: ✅ 强烈推荐（生产环境）

**用途**:
- 存储用户数据
- 联系人信息
- 对话记录
- 目标和计划数据

**优势**:
- 自动备份（7-730天）
- 高可用性（主备切换）
- 自动故障切换
- 性能监控
- 安全防护

**当前配置**:
- 代码中使用: `jdbc:mysql://localhost:3306/relationship_app`
- 生产环境需要改为RDS地址

**推荐配置**:

**生产环境（初期）**:
- 规格: mysql.n2.medium.1（2核4G）
- 存储: 100GB SSD
- 备份: 7天自动备份
- 版本: MySQL 8.0
- 月度费用: ¥300-500

**生产环境（高并发）**:
- 规格: mysql.n4.large.1（4核8G）
- 存储: 500GB SSD
- 读写分离（1主1从）
- 月度费用: ¥800-1,200

**所需修改**:
```properties
# application-prod.properties
spring.datasource.url=jdbc:mysql://rm-xxxxx.mysql.rds.aliyuncs.com:3306/relationship_app?useSSL=true
spring.datasource.username=${RDS_USERNAME}
spring.datasource.password=${RDS_PASSWORD}
```

**费用预估**:
- 初期: ¥300-500/月
- 扩容后: ¥800-1,500/月

**产品链接**: https://www.aliyun.com/product/rds/mysql

---

### 2.3 云数据库 Redis

**状态**: ✅ 推荐使用

**用途**:
- Session存储
- JWT Token黑名单
- 短信验证码缓存
- API限流计数
- 热点数据缓存

**当前状态**:
- 代码中使用了内存Map存储验证码
- 建议改用Redis提高可靠性

**推荐配置**:
- 规格: 2GB标准版
- 架构: 主从版
- 月度费用: ¥100-200

**所需修改**:
```xml
<!-- 添加Redis依赖 -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-redis</artifactId>
</dependency>
```

```properties
# 配置Redis
spring.redis.host=${REDIS_HOST}
spring.redis.port=6379
spring.redis.password=${REDIS_PASSWORD}
spring.redis.database=0
```

**费用预估**: ¥100-300/月

**产品链接**: https://www.aliyun.com/product/redis

---

### 2.4 对象存储 OSS

**状态**: ⭕ 可选（如需文件上传）

**用途**:
- 用户头像存储
- 联系人照片存储
- 聊天图片/文件存储
- 应用静态资源
- 数据库备份文件

**当前状态**:
- 代码中未实现文件上传功能
- 如果未来需要，强烈推荐使用OSS

**推荐配置**:
- 存储类型: 标准存储
- 地域: 华东1（杭州）
- 容量: 按实际使用计费

**技术实现**:
```xml
<!-- Maven依赖 -->
<dependency>
    <groupId>com.aliyun.oss</groupId>
    <artifactId>aliyun-sdk-oss</artifactId>
    <version>3.17.4</version>
</dependency>
```

**所需配置**:
```properties
aliyun.oss.endpoint=oss-cn-hangzhou.aliyuncs.com
aliyun.oss.bucket-name=ulog-app-files
aliyun.oss.access-key-id=${ALIYUN_ACCESS_KEY_ID}
aliyun.oss.access-key-secret=${ALIYUN_ACCESS_KEY_SECRET}
aliyun.oss.upload-url=https://ulog-app-files.oss-cn-hangzhou.aliyuncs.com
```

**费用预估**:
- 存储: ¥0.12/GB/月
- 流量: ¥0.5/GB（外网流出）
- 预计月费用: ¥50-200（根据使用量）

**产品链接**: https://www.aliyun.com/product/oss

---

### 2.5 内容分发网络 CDN

**状态**: ⭕ 推荐使用

**用途**:
- 加速静态资源访问（前端Flutter应用）
- 加速OSS存储的图片/文件
- 降低源站压力
- 提升用户体验

**推荐配置**:
- 加速域名: cdn.yourdomain.com
- 源站类型: OSS域名
- 覆盖区域: 中国大陆

**费用预估**:
- 流量: ¥0.24-0.32/GB
- 预计月费用: ¥100-500

**产品链接**: https://www.aliyun.com/product/cdn

---

### 2.6 负载均衡 SLB

**状态**: ⭕ 扩容时需要

**用途**:
- 多台ECS服务器负载均衡
- 高可用性保障
- 支持健康检查
- 自动流量分发

**推荐配置**:
- 类型: 应用型负载均衡ALB
- 规格: 按量付费
- 后端服务器: 2-4台ECS

**费用预估**: ¥150-300/月

**产品链接**: https://www.aliyun.com/product/slb

---

### 2.7 弹性公网IP

**状态**: ✅ 必需

**用途**:
- ECS服务器外网访问
- 绑定负载均衡器
- API服务对外暴露

**推荐配置**:
- 带宽: 5-10Mbps（按需调整）
- 计费方式: 按流量或按带宽

**费用预估**:
- 按带宽: ¥23/月/Mbps
- 5Mbps: ¥115/月

**产品链接**: https://www.aliyun.com/product/eip

---

## 3. 安全与合规服务

### 3.1 SSL证书服务

**状态**: ✅ 生产环境必需

**用途**:
- HTTPS加密通信
- API安全访问
- 应用商店上架要求
- 用户信任保障

**证书类型**:

**免费证书**:
- DV SSL（域名验证）
- 有效期: 3个月（需续签）
- 适用: 测试环境
- 费用: ¥0

**付费证书**:
- OV SSL（组织验证）
- 有效期: 1年
- 适用: 生产环境
- 费用: ¥2,000-5,000/年

**国密SSL证书**:
- 符合国家密码局标准
- 适用: 政企客户
- 费用: ¥5,000-10,000/年

**推荐**:
- 初期使用免费DV证书
- 正式上线后购买OV证书

**产品链接**: https://www.aliyun.com/product/cas

---

### 3.2 Web应用防火墙 WAF

**状态**: ⭕ 推荐使用

**用途**:
- SQL注入防护
- XSS攻击防护
- 网页防篡改
- CC攻击防护
- 0day漏洞虚拟补丁

**推荐配置**:
- 版本: 高级版
- 防护域名: 1个
- QPS: 5,000

**费用预估**: ¥3,880-9,880/年

**产品链接**: https://www.aliyun.com/product/waf

---

### 3.3 DDoS防护

**状态**: ⭕ 根据需要选择

**用途**:
- DDoS攻击防护
- CC攻击防护
- 保障业务稳定性

**防护能力**:
- 基础防护: 5Gbps（免费）
- DDoS高防: 30Gbps起（付费）

**费用预估**:
- 基础防护: 免费（ECS自带）
- 高级防护: ¥8,800/月起

**产品链接**: https://www.aliyun.com/product/ddos

---

### 3.4 云安全中心（态势感知）

**状态**: ⭕ 推荐使用

**用途**:
- 漏洞检测与修复
- 病毒查杀
- 网站后门检测
- 安全基线检查
- 入侵检测

**推荐配置**:
- 版本: 企业版
- 防护服务器数: 2-5台

**费用预估**: ¥600-1,500/年/台

**产品链接**: https://www.aliyun.com/product/sas

---

### 3.5 数据库审计

**状态**: ⭕ 合规需要

**用途**:
- 数据库操作审计
- 符合等保要求
- 敏感数据访问记录
- 异常行为告警

**费用预估**: ¥9,000-30,000/年

**产品链接**: https://www.aliyun.com/product/dbaudit

---

## 4. 运维监控服务

### 4.1 云监控

**状态**: ✅ 必需（免费）

**用途**:
- ECS性能监控（CPU、内存、磁盘）
- RDS性能监控
- Redis性能监控
- 自定义业务指标监控
- 告警通知

**功能**:
- 基础监控: 免费
- 自定义监控: 部分付费
- 告警通知: 短信/邮件/钉钉

**费用预估**: ¥0-200/月

**产品链接**: https://www.aliyun.com/product/jiankong

---

### 4.2 日志服务 SLS

**状态**: ✅ 强烈推荐

**用途**:
- 应用日志收集
- 访问日志分析
- 错误日志追踪
- 操作审计日志（合规要求）
- 日志查询分析

**功能**:
- 实时日志采集
- 日志存储（6个月）
- 日志查询分析
- 可视化报表
- 告警配置

**当前状态**:
- 代码中使用本地日志文件
- 建议接入SLS统一管理

**技术实现**:
```xml
<!-- Maven依赖 -->
<dependency>
    <groupId>com.aliyun.openservices</groupId>
    <artifactId>aliyun-log-logback-appender</artifactId>
    <version>0.1.23</version>
</dependency>
```

**所需配置**:
```xml
<!-- logback-spring.xml -->
<appender name="ALIYUN" class="com.aliyun.openservices.log.logback.LoghubAppender">
    <endpoint>cn-hangzhou.log.aliyuncs.com</endpoint>
    <accessKeyId>${ALIYUN_ACCESS_KEY_ID}</accessKeyId>
    <accessKeySecret>${ALIYUN_ACCESS_KEY_SECRET}</accessKeySecret>
    <project>ulog-app-logs</project>
    <logStore>application-logs</logStore>
</appender>
```

**费用预估**:
- 存储: ¥0.002/GB/天
- 读写流量: ¥0.15/GB
- 预计月费用: ¥100-500

**产品链接**: https://www.aliyun.com/product/sls

---

### 4.3 应用实时监控 ARMS

**状态**: ⭕ 推荐使用

**用途**:
- API性能监控
- 分布式调用链追踪
- 慢SQL分析
- 异常统计
- 实时报警

**功能**:
- 零代码接入
- 实时性能分析
- 故障诊断
- 链路追踪

**费用预估**: ¥300-1,000/月

**产品链接**: https://www.aliyun.com/product/arms

---

### 4.4 云拨测

**状态**: ⭕ 可选

**用途**:
- 模拟用户访问监控
- 全国节点可用性检测
- 接口响应时间监控
- 服务质量评估

**费用预估**: ¥150-500/月

**产品链接**: https://www.aliyun.com/product/jiankong

---

## 5. 数据服务

### 5.1 数据传输服务 DTS

**状态**: ⭕ 数据迁移时需要

**用途**:
- 数据库迁移（本地→RDS）
- 数据同步
- 数据订阅

**使用场景**:
- 从本地MySQL迁移到RDS
- 实现读写分离的数据同步

**费用预估**: ¥360-1,500/月（按任务）

**产品链接**: https://www.aliyun.com/product/dts

---

### 5.2 数据库备份 DBS

**状态**: ⭕ 额外备份保障

**用途**:
- 数据库逻辑备份
- 跨地域备份
- 长期归档

**费用预估**: ¥200-800/月

**产品链接**: https://www.aliyun.com/product/dbs

---

### 5.3 数据管理 DMS

**状态**: ✅ 免费工具

**用途**:
- 数据库可视化管理
- SQL执行
- 数据导入导出
- 安全审计

**费用**: 基础版免费

**产品链接**: https://www.aliyun.com/product/dms

---

## 6. 备案与资质服务

### 6.1 ICP备案服务

**状态**: ✅ 必需（强制要求）

**用途**:
- 网站/应用域名备案
- 合法运营的前提条件
- 应用商店上架要求

**备案类型**:
1. **ICP备案**（必须）
   - 所有中国大陆服务器必须备案
   - 备案号格式: 京ICP备xxxxx号
   - 费用: 免费
   - 周期: 15-20个工作日

2. **公安备案**（必须）
   - ICP备案完成后30天内完成
   - 登录网站: www.beian.gov.cn
   - 费用: 免费
   - 周期: 5-10个工作日

**备案流程**:
1. 准备材料（营业执照、法人身份证、域名证书）
2. 在阿里云备案系统提交
3. 阿里云初审（1-2工作日）
4. 提交管局审核（10-20工作日）
5. 备案成功，获得备案号

**所需材料**:
- 营业执照副本扫描件
- 法人身份证正反面
- 法人手机号
- 法人邮箱
- 网站负责人信息
- 域名证书
- 备案核验单（加盖公章）

**注意事项**:
- 备案期间网站不能访问
- 需要有阿里云ECS服务器
- 每台ECS可申请5个备案服务号

**费用**: 完全免费（阿里云提供）

**产品链接**: https://beian.aliyun.com

---

### 6.2 域名注册服务

**状态**: ✅ 必需

**用途**:
- 注册应用域名
- API服务域名
- 管理后台域名

**推荐域名**:
- .com: ¥55-75/年
- .cn: ¥29-45/年
- .com.cn: ¥29-45/年

**建议注册**:
- api.yourdomain.com（API服务）
- admin.yourdomain.com（管理后台）
- www.yourdomain.com（官网）

**费用预估**: ¥100-300/年（2-3个域名）

**产品链接**: https://wanwang.aliyun.com/domain

---

### 6.3 云·企业官网

**状态**: ⭕ 可选

**用途**:
- 快速搭建企业官网
- 展示应用介绍
- 隐私政策页面
- 用户协议页面

**费用预估**: ¥980-2,980/年

**替代方案**: 自行开发静态页面部署到OSS

**产品链接**: https://www.aliyun.com/product/webdesign

---

### 6.4 商标注册服务

**状态**: ⭕ 建议注册

**用途**:
- 保护品牌
- 应用商店可能要求
- 防止侵权

**费用预估**: ¥300-800/类

**产品链接**: https://tm.aliyun.com

---

## 7. 其他推荐服务

### 7.1 API网关

**状态**: ⭕ 高级功能

**用途**:
- API统一管理
- 流量控制
- API版本管理
- 鉴权管理

**费用预估**: ¥350-1,500/月

**产品链接**: https://www.aliyun.com/product/apigateway

---

### 7.2 消息队列 RocketMQ

**状态**: ⭕ 高并发场景

**用途**:
- 异步消息处理
- 解耦业务逻辑
- 削峰填谷

**使用场景**:
- 短信异步发送
- 内容审核异步处理
- 操作日志异步记录

**费用预估**: ¥300-1,000/月

**产品链接**: https://www.aliyun.com/product/rocketmq

---

### 7.3 容器服务 Kubernetes（ACK）

**状态**: ⭕ 容器化部署

**用途**:
- 应用容器化部署
- 自动扩缩容
- 灰度发布
- 服务编排

**费用预估**: ¥400-2,000/月（托管版）

**产品链接**: https://www.aliyun.com/product/kubernetes

---

### 7.4 函数计算 FC

**状态**: ⭕ Serverless架构

**用途**:
- 事件驱动函数
- 定时任务
- 数据处理

**费用预估**: 按调用次数，¥50-500/月

**产品链接**: https://www.aliyun.com/product/fc

---

### 7.5 智能语音交互

**状态**: ⭕ 未来扩展

**用途**:
- 语音识别（ASR）
- 语音合成（TTS）
- 语音对话

**费用预估**: 按量计费

**产品链接**: https://ai.aliyun.com/nls

---

### 7.6 机器翻译

**状态**: ⭕ 国际化需要

**用途**:
- 多语言支持
- 内容翻译

**费用预估**: ¥50/百万字符

**产品链接**: https://www.aliyun.com/product/ai/alimt

---

## 8. 成本预算总览

### 8.1 必需服务（生产环境最低配置）

| 服务 | 配置 | 月度费用 | 年度费用 | 优先级 |
|------|------|---------|---------|--------|
| 云服务器 ECS | 4核8G | ¥600 | ¥7,200 | P0 |
| 云数据库 RDS | 2核4G + 100GB | ¥400 | ¥4,800 | P0 |
| 云Redis | 2GB | ¥150 | ¥1,800 | P0 |
| 短信服务 | 10,000条/月 | ¥500 | ¥6,000 | P0 |
| 内容安全 | 300,000次/月 | ¥5,000 | ¥60,000 | P0 |
| SSL证书 | OV证书 | - | ¥3,000 | P0 |
| ICP备案 | - | ¥0 | ¥0 | P0 |
| 域名注册 | 2个域名 | ¥20 | ¥240 | P0 |
| 弹性公网IP | 5Mbps | ¥115 | ¥1,380 | P0 |
| 云监控 | 基础版 | ¥0 | ¥0 | P0 |
| **小计** | | **¥6,785** | **¥84,420** | |

### 8.2 推荐服务（增强功能）

| 服务 | 配置 | 月度费用 | 年度费用 | 优先级 |
|------|------|---------|---------|--------|
| 对象存储 OSS | 100GB | ¥100 | ¥1,200 | P1 |
| CDN | 1TB流量 | ¥200 | ¥2,400 | P1 |
| 日志服务 SLS | 标准版 | ¥300 | ¥3,600 | P1 |
| 实名认证 | 50次/月 | ¥100 | ¥1,200 | P1 |
| Web应用防火墙 | 高级版 | ¥650 | ¥7,800 | P1 |
| 云安全中心 | 企业版 2台 | ¥200 | ¥2,400 | P1 |
| **小计** | | **¥1,550** | **¥18,600** | |

### 8.3 可选服务（规模扩大后）

| 服务 | 配置 | 月度费用 | 年度费用 | 优先级 |
|------|------|---------|---------|--------|
| 负载均衡 SLB | ALB | ¥200 | ¥2,400 | P2 |
| DDoS高防 | 30Gbps | ¥8,800 | ¥105,600 | P2 |
| ARMS监控 | 标准版 | ¥500 | ¥6,000 | P2 |
| API网关 | 标准版 | ¥500 | ¥6,000 | P2 |
| 消息队列 | 标准版 | ¥500 | ¥6,000 | P2 |
| 数据库审计 | 1实例 | ¥1,500 | ¥18,000 | P2 |
| **小计** | | **¥12,000** | **¥144,000** | |

### 8.4 总成本预算

**阶段1: 启动期（前3个月）**
- 必需服务: ¥6,785/月
- 月度总计: **¥6,785**
- 季度总计: **¥20,355**

**阶段2: 成长期（4-12个月）**
- 必需服务 + 推荐服务: ¥8,335/月
- 月度总计: **¥8,335**
- 年度总计（扣除3个月启动期）: **¥75,015**

**第一年总预算**:
- 启动期（3个月）: ¥20,355
- 成长期（9个月）: ¥75,015
- **年度总计: ¥95,370**

**阶段3: 扩张期（第2年起）**
- 全部服务: ¥20,335/月
- 年度总计: **¥244,020**

---

## 9. 实施路线图

### Phase 0: 准备阶段（启动前）

**时间**: 1-2周

**任务清单**:
- [ ] 注册阿里云账号
- [ ] 完成企业实名认证
- [ ] 申请发票抬头
- [ ] 充值账户余额（建议¥5,000起）
- [ ] 创建RAM子账号（安全最佳实践）
- [ ] 配置多因素认证（MFA）

---

### Phase 1: 基础设施搭建（第1-2周）

**优先级**: P0（最高）

**任务清单**:
1. **域名与备案**
   - [ ] 注册域名（api.yourdomain.com）
   - [ ] 提交ICP备案申请（等待15-20天）
   - [ ] 准备公安备案材料

2. **计算资源**
   - [ ] 购买ECS服务器（开发环境 + 生产环境）
   - [ ] 配置安全组规则
   - [ ] 申请弹性公网IP
   - [ ] 安装操作系统和基础软件

3. **数据库**
   - [ ] 创建RDS MySQL实例
   - [ ] 配置白名单
   - [ ] 创建数据库和用户
   - [ ] 测试连接

4. **缓存**
   - [ ] 创建Redis实例
   - [ ] 配置白名单
   - [ ] 测试连接

5. **SSL证书**
   - [ ] 申请免费SSL证书（测试用）
   - [ ] 配置Nginx/域名

**预计费用**: ¥1,000-2,000（首次购买）

---

### Phase 2: 核心业务服务接入（第3-4周）

**优先级**: P0（最高）

**任务清单**:
1. **短信服务**
   - [ ] 开通短信服务
   - [ ] 申请短信签名（审核1-2天）
   - [ ] 创建短信模板（注册/登录/验证）
   - [ ] 修改 `SmsCodeService.java` 代码
   - [ ] 测试短信发送
   - [ ] 实现发送频率限制

2. **内容安全**
   - [ ] 开通内容安全服务
   - [ ] 获取API凭证
   - [ ] 实现 `moderateWithAliyun()` 方法
   - [ ] 测试文本审核
   - [ ] 集成到AI对话流程
   - [ ] 配置审核日志

**代码修改文件**:
- `SmsCodeService.java`
- `ContentModerationService.java`
- `application-prod.properties`

**预计开发时间**: 3-5天

---

### Phase 3: 安全加固（第5-6周）

**优先级**: P1（高）

**任务清单**:
1. **SSL证书升级**
   - [ ] 购买OV SSL证书（正式环境）
   - [ ] 配置HTTPS
   - [ ] 强制HTTPS访问
   - [ ] 测试证书有效性

2. **Web应用防火墙**
   - [ ] 开通WAF服务
   - [ ] 配置防护规则
   - [ ] 测试防护效果

3. **云安全中心**
   - [ ] 开通云安全中心
   - [ ] 安装Agent
   - [ ] 执行安全基线检查
   - [ ] 修复漏洞

**预计费用**: ¥5,000-8,000/年

---

### Phase 4: 监控与日志（第7-8周）

**优先级**: P1（高）

**任务清单**:
1. **云监控配置**
   - [ ] 配置ECS监控告警
   - [ ] 配置RDS监控告警
   - [ ] 配置Redis监控告警
   - [ ] 设置告警联系人（短信/邮件）

2. **日志服务**
   - [ ] 创建SLS项目
   - [ ] 配置logback接入
   - [ ] 测试日志上报
   - [ ] 配置日志查询
   - [ ] 设置日志告警

3. **应用监控（可选）**
   - [ ] 开通ARMS
   - [ ] 接入应用
   - [ ] 配置监控大盘

**代码修改**:
- 添加SLS依赖
- 配置 `logback-spring.xml`

**预计开发时间**: 2-3天

---

### Phase 5: 实名认证（第9-10周）

**优先级**: P1（高）

**任务清单**:
1. **服务开通**
   - [ ] 开通实人认证服务
   - [ ] 申请认证场景
   - [ ] 获取API凭证

2. **功能开发**
   - [ ] 创建 `RealNameAuthService.java`
   - [ ] 实现身份证二要素验证
   - [ ] 实现人脸识别验证（可选）
   - [ ] 创建认证状态表
   - [ ] 开发认证API接口

3. **前端对接**
   - [ ] 前端添加实名认证页面
   - [ ] 测试认证流程

**新增文件**:
- `RealNameAuthService.java`
- `RealNameAuthController.java`
- `RealNameAuthRequest.java`
- 数据库迁移文件

**预计开发时间**: 5-7天

---

### Phase 6: 存储与CDN（按需）

**优先级**: P2（中）

**任务清单**:
1. **对象存储**
   - [ ] 创建OSS Bucket
   - [ ] 配置跨域规则
   - [ ] 配置访问权限
   - [ ] 实现文件上传API
   - [ ] 测试文件上传/下载

2. **CDN加速**
   - [ ] 开通CDN服务
   - [ ] 配置加速域名
   - [ ] 绑定OSS源站
   - [ ] 测试加速效果

**预计开发时间**: 3-4天

---

### Phase 7: 高级功能（按需）

**优先级**: P3（低）

**任务清单**:
- [ ] 负载均衡配置
- [ ] 消息队列接入
- [ ] API网关配置
- [ ] 数据库审计
- [ ] 容器化部署

---

## 10. 配置管理

### 10.1 环境变量配置清单

创建配置文件: `backend/.env.production`

```bash
# 阿里云通用配置
ALIYUN_ACCESS_KEY_ID=LTAI5t***********
ALIYUN_ACCESS_KEY_SECRET=*********************
ALIYUN_REGION_ID=cn-hangzhou

# 数据库配置
RDS_HOST=rm-xxxxx.mysql.rds.aliyuncs.com
RDS_PORT=3306
RDS_DATABASE=relationship_app
RDS_USERNAME=app_user
RDS_PASSWORD=*********************

# Redis配置
REDIS_HOST=r-xxxxx.redis.rds.aliyuncs.com
REDIS_PORT=6379
REDIS_PASSWORD=*********************

# 短信服务配置
ALIYUN_SMS_SIGN_NAME=ULog应用
ALIYUN_SMS_TEMPLATE_REGISTER=SMS_xxxxx
ALIYUN_SMS_TEMPLATE_LOGIN=SMS_xxxxx
ALIYUN_SMS_TEMPLATE_RESET=SMS_xxxxx

# 内容安全配置
CONTENT_MODERATION_PROVIDER=aliyun
CONTENT_MODERATION_ENDPOINT=green.cn-shanghai.aliyuncs.com

# 实名认证配置
ALIYUN_AUTH_SCENE=FVBioOnly

# OSS配置（可选）
ALIYUN_OSS_BUCKET=ulog-app-files
ALIYUN_OSS_ENDPOINT=oss-cn-hangzhou.aliyuncs.com

# 日志服务配置
ALIYUN_SLS_PROJECT=ulog-app-logs
ALIYUN_SLS_LOGSTORE=application-logs
ALIYUN_SLS_ENDPOINT=cn-hangzhou.log.aliyuncs.com

# JWT配置
JWT_SECRET=*********************

# Deepseek配置
DEEPSEEK_API_KEY=sk-*********************
```

### 10.2 安全最佳实践

1. **AccessKey管理**
   - ⚠️ 切勿将AccessKey硬编码到代码中
   - ✅ 使用RAM子账号，按最小权限原则分配
   - ✅ 定期轮换AccessKey（建议每90天）
   - ✅ 启用MFA多因素认证

2. **网络安全**
   - 配置安全组，只开放必要端口
   - 使用白名单限制数据库访问
   - 启用HTTPS，禁用HTTP访问
   - 定期更新系统补丁

3. **数据安全**
   - 启用数据库加密存储
   - 配置自动备份（保留7天）
   - 重要数据跨地域备份
   - 定期测试数据恢复流程

---

## 11. 常见问题 FAQ

### Q1: ICP备案需要多长时间？
**A**: 通常15-20个工作日，具体看各省管局速度。建议尽早开始。

### Q2: 是否必须使用RDS，能用ECS自建数据库吗？
**A**: 可以自建，但RDS提供自动备份、高可用、安全防护等功能，生产环境强烈推荐RDS。

### Q3: 内容安全服务能否只用本地敏感词库？
**A**: 技术上可以，但应用商店审核可能不通过，且法律合规风险较高，强烈建议接入专业服务。

### Q4: 短信服务有免费额度吗？
**A**: 没有免费额度，按量计费，建议做好成本预算和发送频率控制。

### Q5: SSL证书可以一直用免费的吗？
**A**: 免费证书需要每3个月续签，生产环境建议购买付费OV证书（1年有效期）。

### Q6: 如何控制成本？
**A**: 
- 使用包年包月（比按量付费便宜）
- 合理配置实例规格
- 启用费用告警
- 定期清理无用资源
- 监控流量使用情况

### Q7: 数据库需要做读写分离吗？
**A**: 初期不需要，当日活用户>5000或QPS>1000时再考虑。

### Q8: 是否需要容器化部署？
**A**: 初期不需要，传统部署即可。规模扩大后可以考虑容器化。

---

## 12. 联系与支持

### 阿里云官方支持
- **工单系统**: https://workorder.console.aliyun.com
- **客服电话**: 95187
- **文档中心**: https://help.aliyun.com
- **开发者社区**: https://developer.aliyun.com

### 推荐学习资源
- 阿里云大学: https://edu.aliyun.com
- 架构师认证: https://edu.aliyun.com/certification
- 技术博客: https://developer.aliyun.com/article

### 代金券与优惠
- 新用户专享: https://www.aliyun.com/minisite/goods
- 学生优惠: https://developer.aliyun.com/plan/student
- 企业扶持计划: https://www.aliyun.com/support

---

## 13. 附录

### A. 需要添加的Maven依赖汇总

```xml
<!-- 阿里云短信服务 -->
<dependency>
    <groupId>com.aliyun</groupId>
    <artifactId>dysmsapi20170525</artifactId>
    <version>2.0.24</version>
</dependency>

<!-- 阿里云内容安全 -->
<dependency>
    <groupId>com.aliyun</groupId>
    <artifactId>green20220302</artifactId>
    <version>2.0.10</version>
</dependency>

<!-- 阿里云实人认证 -->
<dependency>
    <groupId>com.aliyun</groupId>
    <artifactId>cloudauth20190307</artifactId>
    <version>2.0.7</version>
</dependency>

<!-- 阿里云OSS -->
<dependency>
    <groupId>com.aliyun.oss</groupId>
    <artifactId>aliyun-sdk-oss</artifactId>
    <version>3.17.4</version>
</dependency>

<!-- 阿里云日志服务 -->
<dependency>
    <groupId>com.aliyun.openservices</groupId>
    <artifactId>aliyun-log-logback-appender</artifactId>
    <version>0.1.23</version>
</dependency>

<!-- Spring Boot Redis -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-redis</artifactId>
</dependency>
```

### B. 需要创建的新文件清单

**Java服务类**:
- `AliyunSmsService.java` - 短信发送服务
- `AliyunOssService.java` - OSS文件上传服务
- `RealNameAuthService.java` - 实名认证服务
- `AliyunProperties.java` - 阿里云配置属性

**配置文件**:
- `.env.production` - 生产环境变量
- `logback-spring.xml` - 日志配置（添加SLS）

**数据库迁移**:
- `V8__create_realname_auth_tables.sql` - 实名认证表

### C. 快速启动检查清单

上线前必查项：

**账号与权限**
- [ ] 阿里云账号已实名认证
- [ ] 已创建RAM子账号
- [ ] AccessKey已配置且未泄露
- [ ] 已启用MFA

**基础设施**
- [ ] ECS服务器正常运行
- [ ] RDS数据库已创建并测试
- [ ] Redis实例已创建并测试
- [ ] 域名已购买
- [ ] ICP备案已完成
- [ ] SSL证书已配置

**业务服务**
- [ ] 短信服务已测试（注册/登录）
- [ ] 内容安全已接入（AI对话审核）
- [ ] 实名认证已测试（可选）

**安全配置**
- [ ] 安全组规则已配置
- [ ] WAF已启用
- [ ] HTTPS强制跳转
- [ ] 数据库白名单已配置

**监控告警**
- [ ] 云监控告警已配置
- [ ] 日志服务已接入
- [ ] 告警联系人已设置

**成本控制**
- [ ] 费用告警已设置
- [ ] 包年包月已购买
- [ ] 预算已审批

---

## 14. 总结

本文档详细列出了ULog应用在阿里云平台上可以使用的**30+项服务**，涵盖：

✅ **核心业务**: 短信、内容安全、实名认证  
✅ **基础设施**: ECS、RDS、Redis、OSS、CDN  
✅ **安全合规**: SSL、WAF、DDoS、云安全、ICP备案  
✅ **运维监控**: 云监控、日志服务、ARMS  
✅ **数据服务**: DTS、DBS、DMS  

**关键建议**:
1. **优先实现P0服务**（短信、内容安全、基础设施、备案）
2. **第一年预算**: ¥95,370（约¥8,000/月）
3. **实施周期**: 10-12周（包括备案等待时间）
4. **持续优化**: 根据实际使用情况调整资源配置

**下一步行动**:
1. 注册阿里云账号并实名认证
2. 提交ICP备案（最耗时，优先启动）
3. 按Phase 1-7逐步实施
4. 定期review成本和性能

---

**文档维护**:
- 维护人: 开发团队
- 更新频率: 每季度review一次
- 最后更新: 2025-10-22

如有疑问，请联系阿里云技术支持或查阅官方文档。


